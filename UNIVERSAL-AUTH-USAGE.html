<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:;">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <title>UNIVERSAL AUTH USAGE</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1, h2, h3 { color: #00ffff; }
        code { background: #f4f4f4; padding: 2px 4px; border-radius: 4px; }
        ul { margin-left: 20px; }
        a { color: #00ff99; }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
        body { font-size: 16px; }
        h1 { font-size: 2em; }
        .container { padding: 10px; }
        button, .btn { min-height: 44px; font-size: 16px; }
    }
    </style>
</head>
<body>
    <h1>UNIVERSAL AUTH USAGE</h1>
    <p><h1>üîê Universal Authentication System - Usage Guide</h1></p><p><h2>Overview</h2></p><p>The Universal Authentication system provides <strong>single sign-on (SSO)</strong> across all pages of the BARBRICKDESIGN ecosystem. Once a user connects their wallet on the main index page and signs the verification message, they stay authenticated across ALL pages without reconnecting.</p><p><h2>Key Features</h2></p><p>‚úÖ <strong>Single Sign-On</strong> - Connect once, authenticated everywhere  
‚úÖ <strong>Signature-Based Auth</strong> - Uses signed message for verification  
‚úÖ <strong>24-Hour Sessions</strong> - Auto-expires after 24 hours for security  
‚úÖ <strong>Cross-Page Persistence</strong> - localStorage-based, works across tabs  
‚úÖ <strong>Wallet Verification</strong> - Checks wallet is still connected  
‚úÖ <strong>Platform Agnostic</strong> - Works with Phantom, MetaMask, any wallet  </p><p>---</p><p><h2>Setup (Already Done on Main Pages)</h2></p><p><h3>1. Add Scripts to Your HTML</h3></p><p><code>`</code>html
<head>
    <!-- Solana Web3 (if using Phantom) -->
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.8/lib/index.iife.min.js"></script>
    
    <!-- Universal Auth (MUST be first) -->
    <script src="universal-auth.js"></script>
    <script src="universal-wallet-connect.js"></script>
</head>
<code>`</code></p><p><h3>2. Pages Already Configured</h3></p><p>- ‚úÖ <code>index.html</code> - Main hub (sign-in page)
<ul><li>‚úÖ <code>universal-dev-compensation.html</code></li></ul>
<ul><li>‚úÖ <code>investment-dashboard.html</code></li></ul>
<ul><li>‚úÖ <code>project-status-dashboard.html</code></p><p>---</p><p><h2>How to Use in Your Pages</h2></p><p><h3>Basic Authentication Check</h3></p><p><code>`</code>javascript</li></ul>
// Check if user is authenticated
window.addEventListener('DOMContentLoaded', async function() {
    const isAuth = await window.universalAuth.checkAuth();
    
    if (isAuth) {
        const wallet = window.universalAuth.getWalletInfo();
        } else {
        // Optionally redirect to index.html
        // window.location.href = '/';
    }
});
<code>`</code></p><p><h3>Get Wallet Information</h3></p><p><code>`</code>javascript
const walletInfo = window.universalAuth.getWalletInfo();</p><p>if (walletInfo) {
    // Full address
    // Abbreviated
    // 'Phantom' or 'MetaMask'
    // Signed message
    // Timestamp
}
<code>`</code></p><p><h3>Display Auth Status in UI</h3></p><p><code>`</code>html
<!-- Add this div where you want status displayed -->
<div id="authStatus"></div>
<code>`</code></p><p><code>`</code>javascript
// Auto-displays authentication status
window.universalAuth.displayAuthStatus('authStatus');
<code>`</code></p><p><strong>Output (if authenticated):</strong>
<code>`</code>
‚úÖ Connected: ABC123...XYZ789 (Phantom)
<code>`</code></p><p><strong>Output (if not authenticated):</strong>
<code>`</code>
‚ö†Ô∏è Not connected  [Connect Wallet link]
<code>`</code></p><p><h3>Require Authentication (Protect Pages)</h3></p><p><code>`</code>javascript
// Redirect to index if not authenticated
window.addEventListener('DOMContentLoaded', async function() {
    await window.universalAuth.checkAuth();
    
    if (!window.universalAuth.requireAuth('/index.html')) {
        // User will be redirected, this won't execute
        return;
    }
    
    // User is authenticated, proceed with page logic
    initializePage();
});
<code>`</code></p><p><h3>Use for API Calls</h3></p><p><code>`</code>javascript
// Get headers with wallet authentication
const headers = {
    'Content-Type': 'application/json',
    ...window.universalAuth.getAuthHeaders()
};</p><p>// Headers will include:
// 'X-Wallet-Address': '...'
// 'X-Wallet-Type': 'Phantom'
// 'X-Wallet-Signature': {...}
// 'X-Verified-At': '2025-10-14T...'</p><p>fetch('/api/user-data', {
    method: 'GET',
    headers: headers
}).then(response => response.json())
  .then(data => );
<code>`</code></p><p><h3>Listen for Auth Changes</h3></p><p><code>`</code>javascript
// React to auth status changes
window.addEventListener('authStatusChanged', function(event) {
    const walletInfo = event.detail;
    
    if (walletInfo && walletInfo.isAuthenticated) {
        updateUIForAuthenticatedUser(walletInfo);
    } else {
        updateUIForGuest();
    }
});
<code>`</code></p><p><h3>Verify Wallet Still Connected</h3></p><p><code>`</code>javascript
// Check if wallet hasn't changed
const isStillValid = await window.universalAuth.verifyCurrentWallet();</p><p>if (!isStillValid) {
    alert('Your wallet connection has changed. Please reconnect.');
    window.universalAuth.clearAuth();
    window.location.href = '/';
}
<code>`</code></p><p>---</p><p><h2>Complete Example Page</h2></p><p><code>`</code>html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Protected Page Example</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.8/lib/index.iife.min.js"></script>
    <script src="universal-auth.js"></script>
    <script src="universal-wallet-connect.js"></script>
</head>
<body>
    <div class="container">
        <h1>Protected Page</h1>
        
        <!-- Auth status will appear here -->
        <div id="authStatus"></div>
        
        <div id="content" style="display: none;">
            <h2>Welcome, <span id="walletAddress"></span>!</h2>
            <p>This content is only visible to authenticated users.</p>
            
            <button onclick="logout()">Disconnect</button>
        </div>
        
        <div id="loginPrompt" style="display: none;">
            <p>Please connect your wallet to access this page.</p>
            <a href="/index.html">Go to Main Page</a>
        </div>
    </div></p><p>    <script>
        window.addEventListener('DOMContentLoaded', async function() {
            // Check authentication
            const isAuth = await window.universalAuth.checkAuth();
            
            // Display status badge
            window.universalAuth.displayAuthStatus('authStatus');
            
            if (isAuth) {
                // Show authenticated content
                document.getElementById('content').style.display = 'block';
                
                const wallet = window.universalAuth.getWalletInfo();
                document.getElementById('walletAddress').textContent = wallet.shortAddress;
                
                .toLocaleString());
            } else {
                // Show login prompt
                document.getElementById('loginPrompt').style.display = 'block';
            }
        });
        
        function logout() {
            window.universalAuth.clearAuth();
            window.location.href = '/index.html';
        }
    </script>
</body>
</html>
<code>`</code></p><p>---</p><p><h2>How the Flow Works</h2></p><p><h3>1. Initial Connection (index.html)</h3></p><p><code>`</code>
User clicks "CONNECT WALLET"
    ‚Üì
Wallet opens (Phantom/MetaMask)
    ‚Üì
User approves connection
    ‚Üì
Connection successful
    ‚Üì
Sign verification message
    ‚Üì
Signature stored in localStorage
    ‚Üì
User is now authenticated
<code>`</code></p><p><h3>2. Navigation to Other Pages</h3></p><p><code>`</code>
User clicks link to investment-dashboard.html
    ‚Üì
Page loads universal-auth.js
    ‚Üì
Auto-checks localStorage for wallet_verified
    ‚Üì
Found! User still authenticated
    ‚Üì
No reconnection needed
    ‚Üì
Page shows authenticated content
<code>`</code></p><p><h3>3. Session Expiry (24 hours)</h3></p><p><code>`</code>
User returns after 25 hours
    ‚Üì
universal-auth checks timestamp
    ‚Üì
Session expired
    ‚Üì
clearAuth() called
    ‚Üì
User redirected to index.html
    ‚Üì
Must reconnect wallet
<code>`</code></p><p>---</p><p><h2>localStorage Keys Used</h2></p><p><code>`</code>javascript
'wallet_connected'    // 'true' if connected
'wallet_address'      // Full wallet address
'wallet_type'         // 'Phantom' or 'MetaMask'  
'wallet_balance'      // Last known balance
'wallet_verified'     // 'true' if signature collected
'wallet_signature'    // JSON of signature
'wallet_verified_at'  // ISO timestamp
<code>`</code></p><p>---</p><p><h2>Security Features</h2></p><p>‚úÖ <strong>Signature Verification</strong> - Proves wallet ownership  
‚úÖ <strong>Time-Based Expiry</strong> - Sessions expire after 24 hours  
‚úÖ <strong>Wallet Address Check</strong> - Detects if user switched wallets  
‚úÖ <strong>No Passwords</strong> - Blockchain-native authentication  
‚úÖ <strong>Client-Side Only</strong> - No server dependencies  </p><p>---</p><p><h2>Troubleshooting</h2></p><p><h3>User Not Staying Authenticated</h3></p><p><strong>Check:</strong>
1. Is <code>universal-auth.js</code> loaded on the page?
2. Is it loaded BEFORE other wallet scripts?
3. Check console for errors
4. Verify localStorage has the keys above</p><p><h3>Signature Not Being Saved</h3></p><p><strong>Check:</strong>
1. Message signing happening in <code>index.html</code>
2. <code>signVerificationMessage()</code> function executing
3. No errors in console during signing
4. User not rejecting the signature request</p><p><h3>Authentication Expiring Too Soon</h3></p><p><strong>Solution:</strong>
<ul><li>Increase expiry time in <code>universal-auth.js</code>:</li></ul>
<code>`</code>javascript
// Change from 24 hours to 7 days
if (hoursSinceVerification < 168) { // 7 * 24 = 168
    // ... authenticated
}
<code>`</code></p><p>---</p><p><h2>Best Practices</h2></p><p><h3>1. Always Check Auth Early</h3></p><p><code>`</code>javascript
window.addEventListener('DOMContentLoaded', async function() {
    await window.universalAuth.checkAuth(); // First thing!
    // Then proceed with page logic
});
<code>`</code></p><p><h3>2. Show Friendly Messages</h3></p><p><code>`</code>javascript
if (!isAuth) {
    alert('Please connect your wallet on the main page first!');
    window.location.href = '/';
}
<code>`</code></p><p><h3>3. Handle Wallet Changes</h3></p><p><code>`</code>javascript
setInterval(async () => {
    const isValid = await window.universalAuth.verifyCurrentWallet();
    if (!isValid) {
        alert('Wallet changed! Please reconnect.');
        window.universalAuth.clearAuth();
        window.location.href = '/';
    }
}, 30000); // Check every 30 seconds
<code>`</code></p><p><h3>4. Use Auth for Data Fetching</h3></p><p><code>`</code>javascript
async function loadUserData() {
    const wallet = window.universalAuth.getWalletInfo();
    if (!wallet) return;
    
    // Fetch user-specific data
    const response = await fetch(<code>/api/portfolio/${wallet.address}</code>, {
        headers: window.universalAuth.getAuthHeaders()
    });
    
    const data = await response.json();
    displayData(data);
}
<code>`</code></p><p>---</p><p><h2>Testing</h2></p><p><h3>Test 1: Fresh Connection</h3>
1. Clear localStorage
2. Go to index.html
3. Connect wallet
4. Sign message
5. Navigate to another page
6. Should stay connected ‚úÖ</p><p><h3>Test 2: Refresh Persistence</h3>
1. Connect on index.html
2. Refresh the page
3. Should auto-reconnect ‚úÖ</p><p><h3>Test 3: Cross-Tab Sync</h3>
1. Connect in Tab A
2. Open Tab B (same site)
3. Both tabs should show connected ‚úÖ</p><p><h3>Test 4: Expiry</h3>
1. Change expiry to 1 minute (for testing)
2. Connect wallet
3. Wait 1 minute
4. Refresh - should require reconnection ‚úÖ</p><p>---</p><p><h2>Status: ‚úÖ PRODUCTION READY</h2></p><p>All pages now share authentication. No more reconnecting on every page!</p><p><strong>Files:</strong>
<ul><li>‚úÖ <code>universal-auth.js</code> - Core authentication logic</li></ul>
<ul><li>‚úÖ <code>universal-wallet-connect.js</code> - Wallet connection</li></ul>
<ul><li>‚úÖ <code>index.html</code> - Sign-in page</li></ul>
<ul><li>‚úÖ All dashboard pages - Auto-authenticated</p><p><strong>Next:</strong> Test across all pages and push to GitHub!</li></ul>
</p>
    <hr>
    <p><a href="index.html">‚Üê Back to Home</a></p>
</body>
</html>