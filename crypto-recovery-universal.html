<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://barbrickdesign.github.io/">
    <meta name="twitter:title" content="BARBRICKDESIGN - Elite Web3 Hub">
    <meta name="twitter:description" content="Cutting-edge Web3 development and design solutions">
    <meta name="twitter:image" content="https://barbrickdesign.github.io/header.jpg">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://barbrickdesign.github.io/">
    <meta property="og:title" content="BARBRICKDESIGN - Elite Web3 Hub">
    <meta property="og:description" content="Cutting-edge Web3 development and design solutions">
    <meta property="og:image" content="https://barbrickdesign.github.io/header.jpg">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:;">
  <meta charset="utf-8" />
  <title>Crypto Recovery ‚Äî BarbrickDesign</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Complete crypto recovery solution: Solana rent recovery, dead wallet scanner, scam tracking, exit wallet detection. Recover lost/stolen funds across all chains." />
  
  <!-- Solana -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.iife.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@latest/dist/index.umd.min.js" defer></script>
  
  <!-- Ethereum -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@latest/dist/ethers.umd.min.js" defer></script>
  
  <style>
    :root{
      --bg:#0a0c11; --panel:#0f131a; --muted:#a8b3c7; --text:#eaf1fb;
      --accent:#66fcf1; --good:#3be477; --warn:#fbbf24; --bad:#ff6b6b;
      --stroke:rgba(255,255,255,0.12);
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:radial-gradient(1200px 600px at 20% -20%, rgba(102,252,241,0.06), transparent),var(--bg);color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1400px;margin:0 auto;padding:16px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .card{background:var(--panel);border:1px solid var(--stroke);border-radius:12px;padding:14px}
    .btn{background:#121827;color:var(--text);border:1px solid #223149;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700;transition:all 0.2s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(102,252,241,0.2)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .btn.ghost{background:transparent;border-color:var(--stroke)}
    .btn.primary{background:linear-gradient(135deg,#121a2b,#172238)}
    .btn.active{border-color:var(--accent);box-shadow:0 0 12px rgba(102,252,241,0.3)}
    .mono{font-family:ui-monospace,Menlo,Consolas}
    .small{font-size:13px;color:var(--muted)}
    .title{font-size:20px;font-weight:800}
    .big{font-size:28px;font-weight:800}
    header{display:flex;flex-direction:column;gap:12px;margin-bottom:20px}
    .header-row{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .brand{display:flex;gap:12px;align-items:center}
    .glyph{width:40px;height:40px;border-radius:8px;background:conic-gradient(from 200deg,var(--accent),#9b7bff);box-shadow:0 6px 30px rgba(102,252,241,0.08)}
    .chain-selector{display:flex;gap:8px;padding:8px;background:rgba(0,0,0,0.3);border-radius:12px}
    .chain-btn{padding:8px 16px;border-radius:8px;background:transparent;border:1px solid var(--stroke);color:var(--muted);cursor:pointer;transition:all 0.2s}
    .chain-btn:hover{border-color:var(--accent);color:var(--text)}
    .chain-btn.active{background:var(--accent);color:#000;border-color:var(--accent);font-weight:700}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:16px 0}
    .stat-card{text-align:center;padding:16px;border-radius:10px;background:rgba(102,252,241,0.03);border:1px solid var(--stroke)}
    .stat-value{font-size:24px;font-weight:800;color:var(--accent);margin:8px 0}
    .recovery-list{max-height:400px;overflow-y:auto;margin-top:12px}
    .recovery-item{display:flex;justify-content:space-between;align-items:center;padding:12px;margin:8px 0;border-radius:8px;border:1px solid var(--stroke);background:rgba(0,0,0,0.2)}
    .notice{padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(102,252,241,0.03),transparent);border:1px solid var(--stroke);margin:12px 0}
    .progress-bar{width:100%;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin:8px 0}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),#9b7bff);transition:width 0.3s}
    
    @media (max-width: 768px) {
      .wrap{padding:12px}
      .header-row{flex-direction:column;align-items:stretch}
      .brand{justify-content:center;text-align:center}
      .chain-selector{flex-wrap:wrap;justify-content:center}
      .stats-grid{grid-template-columns:1fr 1fr;gap:8px}
      .title{font-size:18px}
      .big{font-size:24px}
      .recovery-item{flex-direction:column;gap:8px;text-align:left}
      .btn{width:100%;text-align:center}
      .row{flex-direction:column;width:100%}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="header-row">
        <div class="brand">
          <div class="glyph"></div>
          <div>
            <div class="title mono">üíé Crypto Recovery Hub</div>
            <div class="small">Recover Lost Funds ‚Ä¢ Track Scams ‚Ä¢ Close Empty Accounts ‚Ä¢ Find Dead Wallets</div>
          </div>
        </div>
        <div class="row">
          <button id="connectBtn" class="btn primary">Connect Wallet</button>
          <span id="walletStatus" class="small mono">Not connected</span>
        </div>
      </div>

      <div class="chain-selector" id="chainSelector">
        <button class="chain-btn active" data-chain="solana">‚ö° Solana</button>
        <button class="chain-btn" data-chain="ethereum">‚ü† Ethereum</button>
        <button class="chain-btn" data-chain="tracker">üîç Scam Tracker</button>
        <button class="chain-btn" data-chain="bitcoin" disabled>‚Çø Bitcoin (Soon)</button>
      </div>
    </header>

    <main>
      <div class="card">
        <div class="title">Recovery Dashboard</div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="small">Current Chain</div>
            <div class="stat-value" id="currentChain">Solana</div>
          </div>
          <div class="stat-card">
            <div class="small">Recoverable Items</div>
            <div class="stat-value" id="recoverableCount">0</div>
          </div>
          <div class="stat-card">
            <div class="small">Estimated Value</div>
            <div class="stat-value" id="estimatedValue">$0.00</div>
          </div>
          <div class="stat-card">
            <div class="small">Total Recovered</div>
            <div class="stat-value" id="totalRecovered">$0.00</div>
          </div>
        </div>

        <div class="row" style="margin-top:16px">
          <button id="scanBtn" class="btn">üîç Scan Wallet</button>
          <button id="recoverBtn" class="btn ghost" disabled>üí∞ Start Recovery</button>
          <button id="exportBtn" class="btn ghost">üì• Export Report</button>
        </div>

        <div id="progressSection" style="display:none;margin-top:16px">
          <div class="small">Recovery Progress</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width:0%"></div>
          </div>
          <div class="small" id="progressText">0 of 0 complete</div>
        </div>
      </div>

      <!-- Solana Recovery -->
      <div id="solanaPanel" class="card" style="margin-top:16px">
        <div class="title">Solana Recovery</div>
        <div class="notice">
          <strong>What we recover:</strong>
          <ul style="margin:8px 0;padding-left:20px">
            <li>Empty SPL token accounts (rent refunds)</li>
            <li>Dust tokens (< $0.10 value)</li>
            <li>Closed program accounts</li>
          </ul>
          <div class="small">Standard fee: 5% of recovered value</div>
        </div>
        <div class="recovery-list" id="solanaRecoveryList"></div>
      </div>

      <!-- Ethereum Recovery -->
      <div id="ethereumPanel" class="card" style="margin-top:16px;display:none">
        <div class="title">Ethereum Recovery</div>
        <div class="notice">
          <strong>What we recover:</strong>
          <ul style="margin:8px 0;padding-left:20px">
            <li>Dust ERC-20 tokens (< $1.00 value)</li>
            <li>Gas optimization for batch transfers</li>
            <li>Abandoned contract interactions</li>
          </ul>
          <div class="small">Gas costs calculated in real-time ‚Ä¢ 5% fee on recovered value</div>
        </div>
        <div class="recovery-list" id="ethereumRecoveryList"></div>
      </div>

      <!-- Scam Tracker Panel -->
      <div id="trackerPanel" class="card" style="margin-top:16px;display:none">
        <div class="title">üîç Scam Tracker & Wallet Analysis</div>
        <div class="notice">
          <strong>Track stolen funds and identify exit wallets:</strong>
          <ul style="margin:8px 0;padding-left:20px">
            <li>Enter victim wallet to track fund flow</li>
            <li>Identify exit wallets holding stolen funds</li>
            <li>Scan connected wallets for dead accounts (0.002 SOL)</li>
            <li>Calculate total recoverable amount</li>
            <li>Generate scam reports for authorities</li>
          </ul>
        </div>

        <div style="margin-top:16px">
          <label class="small" style="display:block;margin-bottom:8px">Victim/Target Wallet Address</label>
          <input id="victimWallet" type="text" placeholder="Enter Solana wallet address" style="width:100%;padding:10px;background:var(--panel);border:1px solid var(--stroke);border-radius:8px;color:var(--text);font-family:monospace">
        </div>

        <div class="row" style="margin-top:12px">
          <button id="trackWalletBtn" class="btn">üîç Track Wallet</button>
          <button id="findExitWalletsBtn" class="btn ghost">üíº Find Exit Wallets</button>
          <button id="scanConnectedBtn" class="btn ghost">üîó Scan Connected</button>
          <button id="findDeadWalletsBtn" class="btn ghost">üíÄ Find Dead Wallets</button>
        </div>

        <div id="trackerResults" style="margin-top:16px"></div>

        <div class="stats-grid" style="margin-top:16px">
          <div class="stat-card">
            <div class="small">Tracked Wallets</div>
            <div class="stat-value" id="trackedCount">0</div>
          </div>
          <div class="stat-card">
            <div class="small">Exit Wallets Found</div>
            <div class="stat-value" id="exitWalletCount">0</div>
          </div>
          <div class="stat-card">
            <div class="small">Total Recoverable</div>
            <div class="stat-value" id="recoverableAmount">0 SOL</div>
          </div>
          <div class="stat-card">
            <div class="small">Suspicious Score</div>
            <div class="stat-value" id="suspiciousScore" style="color:var(--warn)">0</div>
          </div>
        </div>

        <div class="recovery-list" id="exitWalletsList" style="margin-top:16px"></div>
      </div>

      <!-- Transaction History -->
      <div class="card" style="margin-top:16px">
        <div class="title">Recovery History</div>
        <div id="historyList" class="recovery-list">
          <div class="small" style="text-align:center;padding:20px;color:var(--muted)">
            No recovery transactions yet
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Wallet Tracker Module -->
  <script src="mandem.os/workspace/public/walletTracker.js" defer></script>
  <script>
    // ==================== CORE STATE ====================
    const state = {
      currentChain: 'solana',
      wallet: null,
      provider: null,
      recoverables: [],
      history: [],
      stats: {
        totalRecovered: 0,
        sessionRecovered: 0
      }
    };

    // ==================== CONSTANTS ====================
    const CHAINS = {
      solana: {
        name: 'Solana',
        rpc: 'https://api.mainnet-beta.solana.com',
        rentPerAccount: 0.00204,
        feeWallet: '5hSWosj58ki4A6hSfQrvteQU5QvyCWmhHn4AuqgaQzqr',
        feePct: 0.05
      },
      ethereum: {
        name: 'Ethereum',
        rpc: 'https://eth.llamarpc.com',
        minDustUSD: 1.00,
        feeWallet: '0x742d35Cc6634C0532925a3b844Bc454e4438f44e',
        feePct: 0.05
      }
    };

    // ==================== UTILITIES ====================
    function log(...args) {
      }

    function setStatus(msg, type = 'info') {
      log(msg);
      // Could add toast notifications here
    }

    function updateUI() {
      document.getElementById('currentChain').textContent = CHAINS[state.currentChain].name;
      document.getElementById('recoverableCount').textContent = state.recoverables.length;
      
      const estValue = state.recoverables.reduce((sum, item) => sum + (item.value || 0), 0);
      document.getElementById('estimatedValue').textContent = `$${estValue.toFixed(2)}`;
      document.getElementById('totalRecovered').textContent = `$${state.stats.totalRecovered.toFixed(2)}`;
      
      document.getElementById('recoverBtn').disabled = state.recoverables.length === 0;
    }

    function renderHistory() {
      const list = document.getElementById('historyList');
      if (state.history.length === 0) {
        list.innerHTML = '<div class="small" style="text-align:center;padding:20px;color:var(--muted)">No recovery transactions yet</div>';
        return;
      }
      
      list.innerHTML = state.history.map(item => `
        <div class="recovery-item">
          <div>
            <div class="mono small">${item.chain}</div>
            <div class="small">${item.description}</div>
            <div class="small" style="opacity:0.7">${new Date(item.timestamp).toLocaleString()}</div>
          </div>
          <div style="text-align:right">
            <div style="color:var(--good);font-weight:700">+$${item.value.toFixed(2)}</div>
            <a href="${item.explorerUrl}" target="_blank" class="small" style="color:var(--accent)">View ‚Üó</a>
          </div>
        </div>
      `).join('');
    }

    // ==================== SOLANA FUNCTIONS ====================
    const solana = {
      connection: null,

      async init() {
        if (!window.solanaWeb3) throw new Error('Solana Web3.js not loaded');
        this.connection = new solanaWeb3.Connection(CHAINS.solana.rpc, 'confirmed');
        log('Solana initialized');
      },

      async connect() {
        const provider = window.solana;
        if (!provider) throw new Error('Phantom wallet not found');
        
        const resp = await provider.connect();
        state.wallet = resp.publicKey;
        state.provider = provider;
        
        log('Solana wallet connected:', state.wallet.toBase58());
        return {
          address: state.wallet.toBase58(),
          chain: 'solana'
        };
      },

      async scan() {
        if (!state.wallet) throw new Error('Wallet not connected');
        
        setStatus('Scanning Solana accounts...');
        state.recoverables = [];

        try {
          // Scan for empty SPL token accounts
          const tokenAccounts = await this.connection.getParsedTokenAccountsByOwner(
            state.wallet,
            { programId: splToken.TOKEN_PROGRAM_ID }
          );

          const emptyAccounts = tokenAccounts.value.filter(acc => {
            const amount = acc.account.data.parsed.info.tokenAmount.uiAmount;
            return amount === 0;
          });

          emptyAccounts.forEach(acc => {
            state.recoverables.push({
              type: 'empty_account',
              address: acc.pubkey.toBase58(),
              chain: 'solana',
              value: CHAINS.solana.rentPerAccount * 5, // Approximate USD value
              description: 'Empty SPL token account',
              rentLamports: 2039280
            });
          });

          // Scan for dust tokens (< $0.10 value)
          const activeAccounts = tokenAccounts.value.filter(acc => {
            const amount = acc.account.data.parsed.info.tokenAmount.uiAmount;
            return amount > 0 && amount < 100; // Heuristic for dust
          });

          activeAccounts.forEach(acc => {
            const info = acc.account.data.parsed.info;
            state.recoverables.push({
              type: 'dust_token',
              address: acc.pubkey.toBase58(),
              mint: info.mint,
              chain: 'solana',
              value: 0.05, // Estimate
              description: `Dust token (${info.tokenAmount.uiAmount} tokens)`,
              amount: info.tokenAmount.uiAmount
            });
          });

          log(`Found ${state.recoverables.length} recoverable items on Solana`);
          this.renderRecoverables();
          updateUI();
          
        } catch (error) {
          log('Solana scan error:', error);
          throw error;
        }
      },

      renderRecoverables() {
        const list = document.getElementById('solanaRecoveryList');
        if (state.recoverables.length === 0) {
          list.innerHTML = '<div class="notice">No recoverable items found. Your wallet is optimized! ‚ú®</div>';
          return;
        }

        list.innerHTML = state.recoverables.map((item, index) => `
          <div class="recovery-item">
            <div>
              <div style="font-weight:700">${item.description}</div>
              <div class="mono small" style="opacity:0.7">${item.address.slice(0, 8)}...${item.address.slice(-6)}</div>
            </div>
            <div style="text-align:right">
              <div style="color:var(--good);font-weight:700">~$${item.value.toFixed(3)}</div>
              <div class="small">+ ${(item.rentLamports || 0) / 1e9} SOL rent</div>
            </div>
          </div>
        `).join('');
      },

      async recover() {
        if (state.recoverables.length === 0) return;
        
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        progressSection.style.display = 'block';
        
        let completed = 0;
        const total = state.recoverables.length;

        for (const item of state.recoverables) {
          try {
            if (item.type === 'empty_account') {
              const tx = new solanaWeb3.Transaction().add(
                splToken.createCloseAccountInstruction(
                  new solanaWeb3.PublicKey(item.address),
                  state.wallet,
                  state.wallet,
                  []
                )
              );

              tx.feePayer = state.wallet;
              tx.recentBlockhash = (await this.connection.getLatestBlockhash()).blockhash;

              const signed = await state.provider.signTransaction(tx);
              const signature = await this.connection.sendRawTransaction(signed.serialize());
              await this.connection.confirmTransaction(signature, 'confirmed');

              // Add to history
              state.history.unshift({
                chain: 'Solana',
                description: item.description,
                value: item.value,
                timestamp: Date.now(),
                explorerUrl: `https://explorer.solana.com/tx/${signature}`
              });

              state.stats.totalRecovered += item.value;
              log('Recovered:', item.address, signature);
            }

            completed++;
            const progress = (completed / total) * 100;
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${completed} of ${total} complete`;

          } catch (error) {
            log('Recovery error:', item.address, error);
          }

          await new Promise(r => setTimeout(r, 200)); // Rate limiting
        }

        state.recoverables = [];
        updateUI();
        renderHistory();
        progressSection.style.display = 'none';
        setStatus('Recovery complete!', 'success');
      }
    };

    // ==================== ETHEREUM FUNCTIONS ====================
    const ethereum = {
      provider: null,

      async init() {
        if (!window.ethers) throw new Error('Ethers.js not loaded');
        log('Ethereum initialized');
      },

      async connect() {
        if (!window.ethereum) throw new Error('MetaMask not found');
        
        this.provider = new ethers.providers.Web3Provider(window.ethereum);
        await this.provider.send("eth_requestAccounts", []);
        const signer = this.provider.getSigner();
        const address = await signer.getAddress();
        
        state.wallet = address;
        state.provider = signer;
        
        log('Ethereum wallet connected:', address);
        return {
          address,
          chain: 'ethereum'
        };
      },

      async scan() {
        if (!state.wallet) throw new Error('Wallet not connected');
        
        setStatus('Scanning Ethereum tokens...');
        state.recoverables = [];

        try {
          // This is a simplified version - in production, you'd use services like:
          // - Alchemy Token API
          // - Etherscan API
          // - Moralis API
          
          const notice = document.getElementById('ethereumRecoveryList');
          notice.innerHTML = `
            <div class="notice">
              <strong>Ethereum scanning requires API integration</strong>
              <p class="small" style="margin-top:8px">
                To scan for ERC-20 dust tokens and gas optimization opportunities, 
                integrate with Alchemy, Etherscan, or Moralis APIs.
              </p>
              <div style="margin-top:12px">
                <strong>Capabilities:</strong>
                <ul style="margin:8px 0;padding-left:20px">
                  <li>Detect low-value ERC-20 tokens</li>
                  <li>Calculate optimal gas for batch operations</li>
                  <li>Identify abandoned approvals</li>
                  <li>Consolidate dust to main wallet</li>
                </ul>
              </div>
            </div>
          `;

          // Placeholder recovery items
          state.recoverables.push({
            type: 'dust_erc20',
            chain: 'ethereum',
            value: 0.45,
            description: 'Mock dust token (API integration needed)',
            address: '0x...'
          });

          updateUI();
          
        } catch (error) {
          log('Ethereum scan error:', error);
          throw error;
        }
      },

      renderRecoverables() {
        // Similar to Solana but for Ethereum items
      },

      async recover() {
        setStatus('Ethereum recovery requires API integration', 'info');
        // Implement batch transfer logic here
      }
    };

    // ==================== MAIN APP ====================
    async function init() {
      // Initialize chains
      await solana.init();
      await ethereum.init();

      // Load saved history
      try {
        const saved = localStorage.getItem('recovery_history');
        if (saved) {
          state.history = JSON.parse(saved);
          state.stats.totalRecovered = state.history.reduce((sum, item) => sum + item.value, 0);
          renderHistory();
          updateUI();
        }
      } catch (e) {
        log('Failed to load history:', e);
      }
    }

    // ==================== EVENT HANDLERS ====================
    document.getElementById('connectBtn').addEventListener('click', async () => {
      try {
        let result;
        if (state.currentChain === 'solana') {
          result = await solana.connect();
        } else if (state.currentChain === 'ethereum') {
          result = await ethereum.connect();
        }
        
        document.getElementById('walletStatus').textContent = 
          `${result.address.slice(0, 6)}...${result.address.slice(-4)}`;
        setStatus('Wallet connected!', 'success');
      } catch (error) {
        setStatus('Connection failed: ' + error.message, 'error');
      }
    });

    document.getElementById('scanBtn').addEventListener('click', async () => {
      try {
        if (state.currentChain === 'solana') {
          await solana.scan();
        } else if (state.currentChain === 'ethereum') {
          await ethereum.scan();
        }
      } catch (error) {
        setStatus('Scan failed: ' + error.message, 'error');
      }
    });

    document.getElementById('recoverBtn').addEventListener('click', async () => {
      if (!confirm(`Start recovery of ${state.recoverables.length} items? Each will require wallet approval.`)) return;
      
      try {
        if (state.currentChain === 'solana') {
          await solana.recover();
        } else if (state.currentChain === 'ethereum') {
          await ethereum.recover();
        }
        
        // Save history
        localStorage.setItem('recovery_history', JSON.stringify(state.history));
      } catch (error) {
        setStatus('Recovery failed: ' + error.message, 'error');
      }
    });

    document.getElementById('exportBtn').addEventListener('click', () => {
      const report = {
        timestamp: new Date().toISOString(),
        chain: state.currentChain,
        wallet: state.wallet?.toBase58?.() || state.wallet || 'Not connected',
        stats: state.stats,
        history: state.history,
        recoverables: state.recoverables
      };
      
      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `recovery-report-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      setStatus('Report exported', 'success');
    });

    // ==================== WALLET TRACKER INTEGRATION ====================
    let walletTracker = null;

    async function initWalletTracker() {
      if (!walletTracker && typeof WalletTracker !== 'undefined') {
        walletTracker = new WalletTracker(solana.connection);
        log('Wallet tracker initialized');
      }
    }

    // Track Wallet Button
    document.getElementById('trackWalletBtn')?.addEventListener('click', async () => {
      const victimAddr = document.getElementById('victimWallet').value.trim();
      if (!victimAddr) {
        alert('Please enter a wallet address');
        return;
      }

      await initWalletTracker();
      setStatus('Tracking wallet and analyzing transactions...', 'info');
      
      try {
        const tracked = await walletTracker.trackWallet(victimAddr, 2);
        
        if (tracked) {
          document.getElementById('trackedCount').textContent = walletTracker.trackedWallets.size;
          document.getElementById('suspiciousScore').textContent = tracked.suspiciousScore;
          
          const results = document.getElementById('trackerResults');
          results.innerHTML = `
            <div class="notice" style="background:${tracked.suspiciousScore > 50 ? 'rgba(255,107,107,0.1)' : 'rgba(59,228,119,0.1)'}">
              <strong>Analysis Results:</strong>
              <div style="margin-top:8px">
                <div>Total Inflows: ${tracked.totalIn.toFixed(4)} SOL (${tracked.inflows.length} transactions)</div>
                <div>Total Outflows: ${tracked.totalOut.toFixed(4)} SOL (${tracked.outflows.length} transactions)</div>
                <div>Net Flow: ${tracked.netFlow.toFixed(4)} SOL</div>
                <div>Connected Wallets: ${tracked.connectedWallets.size}</div>
                <div>Flags: ${tracked.flags.join(', ') || 'None'}</div>
              </div>
            </div>
          `;
          
          setStatus('Wallet tracking complete', 'success');
        }
      } catch (error) {
        log('Tracking error:', error);
        setStatus('Tracking failed: ' + error.message, 'error');
      }
    });

    // Find Exit Wallets Button
    document.getElementById('findExitWalletsBtn')?.addEventListener('click', async () => {
      const victimAddr = document.getElementById('victimWallet').value.trim();
      if (!victimAddr) {
        alert('Please enter a wallet address');
        return;
      }

      await initWalletTracker();
      setStatus('Finding exit wallets...', 'info');
      
      try {
        const exitWallets = await walletTracker.findExitWallets(victimAddr);
        
        document.getElementById('exitWalletCount').textContent = exitWallets.length;
        
        const list = document.getElementById('exitWalletsList');
        if (exitWallets.length === 0) {
          list.innerHTML = '<div class="notice">No exit wallets found with significant balances</div>';
        } else {
          list.innerHTML = exitWallets.map(wallet => `
            <div class="recovery-item">
              <div>
                <div style="font-weight:700;color:var(--bad)">Exit Wallet Detected</div>
                <div class="mono small">${wallet.address}</div>
                <div class="small">Flags: ${wallet.flags.join(', ') || 'None'}</div>
              </div>
              <div style="text-align:right">
                <div style="color:var(--warn);font-weight:700">${wallet.currentBalance.toFixed(4)} SOL</div>
                <div class="small">Received: ${wallet.receivedAmount.toFixed(4)} SOL</div>
                <div class="small">Score: ${wallet.suspiciousScore}</div>
              </div>
            </div>
          `).join('');
        }
        
        setStatus(`Found ${exitWallets.length} potential exit wallet(s)`, 'success');
      } catch (error) {
        log('Exit wallet search error:', error);
        setStatus('Search failed: ' + error.message, 'error');
      }
    });

    // Scan Connected Wallets Button
    document.getElementById('scanConnectedBtn')?.addEventListener('click', async () => {
      const victimAddr = document.getElementById('victimWallet').value.trim();
      if (!victimAddr) {
        alert('Please enter a wallet address');
        return;
      }

      await initWalletTracker();
      setStatus('Scanning connected wallets...', 'info');
      
      try {
        const connected = await walletTracker.scanConnectedWallets(victimAddr);
        
        const list = document.getElementById('exitWalletsList');
        if (connected.length === 0) {
          list.innerHTML = '<div class="notice">No connected wallets found</div>';
        } else {
          const deadWallets = connected.filter(w => w.isDead);
          let totalRecoverable = deadWallets.reduce((sum, w) => sum + w.balance, 0);
          
          document.getElementById('recoverableAmount').textContent = totalRecoverable.toFixed(4) + ' SOL';
          
          list.innerHTML = connected.slice(0, 20).map(wallet => `
            <div class="recovery-item">
              <div>
                <div style="font-weight:700">${wallet.isDead ? 'üíÄ Dead Wallet' : 'Connected Wallet'}</div>
                <div class="mono small">${wallet.address}</div>
                ${wallet.hasRent ? '<div class="small" style="color:var(--good)">Has recoverable rent</div>' : ''}
              </div>
              <div style="text-align:right">
                <div style="font-weight:700;color:${wallet.isDead ? 'var(--warn)' : 'var(--text)'}">
                  ${wallet.balance.toFixed(4)} SOL
                </div>
                ${wallet.isDead ? '<div class="small" style="color:var(--good)">Recoverable</div>' : ''}
              </div>
            </div>
          `).join('');
        }
        
        setStatus(`Found ${connected.length} connected wallet(s)`, 'success');
      } catch (error) {
        log('Connected wallet scan error:', error);
        setStatus('Scan failed: ' + error.message, 'error');
      }
    });

    // Find Dead Wallets Button
    document.getElementById('findDeadWalletsBtn')?.addEventListener('click', async () => {
      await initWalletTracker();
      
      if (!walletTracker.trackedWallets.size) {
        alert('Please track a wallet first to find connected dead wallets');
        return;
      }

      setStatus('Searching for dead wallets with 0.002 SOL...', 'info');
      
      try {
        const allWallets = [];
        for (const [addr, data] of walletTracker.trackedWallets) {
          allWallets.push(addr);
          data.connectedWallets.forEach(w => allWallets.push(w));
        }

        const deadWallets = await walletTracker.findDeadWallets([...new Set(allWallets)]);
        
        let totalRecoverable = deadWallets.reduce((sum, w) => sum + w.balance, 0);
        document.getElementById('recoverableAmount').textContent = totalRecoverable.toFixed(4) + ' SOL';
        
        const list = document.getElementById('exitWalletsList');
        if (deadWallets.length === 0) {
          list.innerHTML = '<div class="notice">No dead wallets found with recoverable balances</div>';
        } else {
          list.innerHTML = deadWallets.map(wallet => `
            <div class="recovery-item">
              <div>
                <div style="font-weight:700;color:var(--warn)">üíÄ Dead Wallet</div>
                <div class="mono small">${wallet.address}</div>
                <div class="small">
                  ${wallet.daysInactive ? `Inactive ${wallet.daysInactive} days` : 'Activity unknown'}
                </div>
              </div>
              <div style="text-align:right">
                <div style="color:var(--good);font-weight:700">${wallet.balance.toFixed(4)} SOL</div>
                <div class="small">Recoverable</div>
              </div>
            </div>
          `).join('');
        }
        
        setStatus(`Found ${deadWallets.length} dead wallet(s) with ${totalRecoverable.toFixed(4)} SOL`, 'success');
      } catch (error) {
        log('Dead wallet search error:', error);
        setStatus('Search failed: ' + error.message, 'error');
      }
    });

    // Chain selector
    document.querySelectorAll('.chain-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.disabled) return;
        
        const chain = btn.dataset.chain;
        state.currentChain = chain;
        state.recoverables = [];
        state.wallet = null;
        
        // Update UI
        document.querySelectorAll('.chain-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        document.getElementById('solanaPanel').style.display = chain === 'solana' ? 'block' : 'none';
        document.getElementById('ethereumPanel').style.display = chain === 'ethereum' ? 'block' : 'none';
        document.getElementById('trackerPanel').style.display = chain === 'tracker' ? 'block' : 'none';
        document.getElementById('walletStatus').textContent = 'Not connected';
        
        updateUI();
        log('Switched to', chain);
        
        if (chain === 'tracker') {
          initWalletTracker();
        }
      });
    });

    // Initialize on load
    window.addEventListener('load', init);
  </script>
</body>
</html>
