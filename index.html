<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BarbrickDesign â€” Recover and Earn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin:0; font-family: Inter, sans-serif; background:#0a0c11; color:#eaf1fb; }
    header, footer { display:flex; justify-content:space-between; align-items:center; padding:16px 24px; background:#0f131a; }
    .btn { background:#121827; color:#eaf1fb; border:1px solid #223149; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; }
    .btn:hover { border-color:#66fcf1; }
    .hero { padding:32px; text-align:center; background:#0f131a; }
    .big { font-size:36px; font-weight:900; margin:12px 0; }
    .small { font-size:12px; color:#a8b3c7; }
    .mono { font-family: ui-monospace, Menlo, Consolas, monospace; }
  </style>
</head>
<body>
  <header>
    <div>BarbrickDesign</div>
    <div>
      <button id="connectBtn" class="btn">Connect Wallet</button>
      <button id="resetBtn" class="btn">Reset</button>
    </div>
  </header>

  <section class="hero">
    <h1>ðŸ’° Instantly Reclaim Lost Crypto</h1>
    <p class="small">Keep 95% â€” lowest fee in the game. User pays gas.</p>
    <label for="chainSelect">Recovery chain:</label>
    <select id="chainSelect" class="btn">
      <option value="solana" selected>Solana (Phantom)</option>
      <option value="ethereum">Ethereum (MetaMask)</option>
      <option value="polygon">Polygon</option>
      <option value="bsc">BSC</option>
    </select>
    <div class="big" id="refundEstimateBig">0.00000</div>
    <p id="status" class="small">Connect your wallet to begin.</p>
    <button id="scanBtn" class="btn">Scan</button>
    <button id="recoverBtn" class="btn">Recover Now</button>
    <p class="small">Wallet ID: <span id="walletLabel" class="mono">â€”</span></p>
  </section>

  <footer>
    <span class="small">Â© BarbrickDesign 2025</span>
  </footer>

  <!-- Load Solana + SPL Token first -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.6/lib/index.iife.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@0.3.11/dist/browser/spl-token.min.js"></script>
  <!-- Load ethers.js for EVM -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.1/dist/ethers.umd.min.js"></script>

  <!-- Your app logic -->
  <script>
    const solConnection = new solanaWeb3.Connection('https://api.mainnet-beta.solana.com','confirmed');
    const FEE_WALLET = new solanaWeb3.PublicKey('5hSWosj58ki4A6hSfQrvteQU5QvyCWmhHn4AuqgaQzqr');
    const RENT_PER_EMPTY_ACCOUNT_SOL = 0.00204;
    const DONATION_PCT = 0.05;

    let chain = 'solana';
    let solWallet = null;
    let evmWallet = null;
    let emptyAccounts = [];

    const chainSelect = document.getElementById('chainSelect');
    const statusEl = document.getElementById('status');
    const walletLabel = document.getElementById('walletLabel');
    const refundEstimateBigEl = document.getElementById('refundEstimateBig');

    function setStatus(msg){ statusEl.textContent = msg; }
    function shorten(s){ return s ? s.slice(0,4)+'...'+s.slice(-4) : 'â€”'; }

    chainSelect.addEventListener('change', e => {
      chain = e.target.value;
      setStatus(`Selected ${chain.toUpperCase()}. Connect wallet.`);
      refundEstimateBigEl.textContent = chain==='solana' ? '0.00000 SOL' : 'â€”';
    });

    async function connectWallet(){
      if(chain==='solana'){
        const provider = window.solana;
        if(!provider){ setStatus('Install Phantom.'); return; }
        const resp = await provider.connect();
        solWallet = resp.publicKey;
        walletLabel.textContent = shorten(solWallet.toBase58());
        setStatus('Solana wallet connected.');
      } else {
        if(!window.ethereum){ setStatus('Install MetaMask.'); return; }
        const provider = new ethers.BrowserProvider(window.ethereum);
        const accounts = await provider.send('eth_requestAccounts',[]);
        evmWallet = accounts[0];
        walletLabel.textContent = shorten(evmWallet);
        setStatus(`${chain.toUpperCase()} wallet connected.`);
      }
    }

    function resetConnection(){
      solWallet=null; evmWallet=null; emptyAccounts=[];
      walletLabel.textContent='â€”';
      refundEstimateBigEl.textContent='0.00000';
      setStatus('Connection reset.');
    }

    async function scan(){
      if(chain==='solana'){
        if(!solWallet){ setStatus('Connect wallet first.'); return; }
        const res = await solConnection.getParsedTokenAccountsByOwner(solWallet,{programId:splToken.TOKEN_PROGRAM_ID});
        emptyAccounts = res.value.filter(acc=>Number(acc.account.data.parsed.info.tokenAmount.uiAmount)===0);
        const est = emptyAccounts.length*RENT_PER_EMPTY_ACCOUNT_SOL;
        refundEstimateBigEl.textContent=est.toFixed(5)+' SOL';
        setStatus(`Found ${emptyAccounts.length} empty accounts.`);
      } else {
        if(!evmWallet){ setStatus('Connect wallet first.'); return; }
        setStatus(`Check ${chain} explorer for activity: ${evmWallet}`);
      }
    }

    async function recover(){
      if(chain==='solana'){
        if(!solWallet){ setStatus('Connect wallet first.'); return; }
        if(emptyAccounts.length===0){ setStatus('No empty accounts.'); return; }
        setStatus('Recovery complete (demo). Rent refunded to your wallet.');
        refundEstimateBigEl.textContent='0.00000 SOL';
      } else {
        setStatus('Multi-chain recovery requires indexers. Use explorer + revoke.cash for now.');
      }
    }

    document.getElementById('connectBtn').addEventListener('click', connectWallet);
    document.getElementById('resetBtn').addEventListener('click', resetConnection);
    document.getElementById('scanBtn').addEventListener('click', scan);
    document.getElementById('recoverBtn').addEventListener('click', recover);
  </script>
</body>
