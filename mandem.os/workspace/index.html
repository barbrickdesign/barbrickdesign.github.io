<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gem Bot Universe - Future Knowledge Hub</title>
    <meta name="description" content="Advanced AI-driven knowledge platform for creative professionals and innovators">

    <!-- Cyberpunk Theme CSS -->
    <style>
        :root {
            --neon-blue: #00ffff;
            --neon-pink: #ff1493;
            --neon-green: #00ff88;
            --neon-orange: #ff6b35;
            --dark-bg: #0a0a0a;
            --darker-bg: #050505;
            --panel-bg: rgba(20, 20, 20, 0.95);
            --text-glow: 0 0 10px var(--neon-blue);
            --border-glow: 0 0 15px var(--neon-blue);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            color: var(--neon-blue);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 20, 147, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite alternate;
            z-index: -1;
        }

        @keyframes backgroundShift {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(1deg); }
        }

        /* Header */
        header {
            position: relative;
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid var(--neon-blue);
            box-shadow: var(--border-glow);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 3rem;
            font-weight: bold;
            text-shadow: var(--text-glow);
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-desc {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        /* Navigation */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-card {
            background: var(--panel-bg);
            border: 1px solid var(--neon-blue);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.1);
        }

        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--border-glow);
            border-color: var(--neon-pink);
        }

        .nav-card h3 {
            color: var(--neon-green);
            margin-bottom: 0.5rem;
            font-size: 1.4rem;
        }

        .nav-card p {
            color: var(--neon-blue);
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Status Panel */
        .status-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--panel-bg);
            border: 1px solid var(--neon-green);
            border-radius: 8px;
            padding: 1rem;
            min-width: 250px;
            box-shadow: var(--border-glow);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .status-panel h4 {
            color: var(--neon-green);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem;
            font-size: 0.8rem;
        }

        .status-value {
            color: var(--neon-blue);
        }

        .status-active {
            color: var(--neon-green);
        }

        /* 3D Container */
        #globe-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            pointer-events: none;
        }

        /* Content Panels */
        .content-panel {
            background: var(--panel-bg);
            border: 1px solid var(--neon-blue);
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1000px;
            box-shadow: var(--border-glow);
            backdrop-filter: blur(10px);
        }

        .content-panel h2 {
            color: var(--neon-pink);
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: var(--text-glow);
        }

        /* Buttons */
        .cyber-btn {
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            color: black;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            box-shadow: var(--border-glow);
        }

        .cyber-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--neon-pink);
        }

        .cyber-btn-secondary {
            background: transparent;
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
        }

        .cyber-btn-secondary:hover {
            background: var(--neon-green);
            color: black;
        }

        /* Agent Cards */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .agent-card {
            background: var(--panel-bg);
            border: 1px solid var(--neon-orange);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.2);
        }

        .agent-card h3 {
            color: var(--neon-orange);
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px var(--neon-orange);
        }

        .agent-card p {
            color: var(--neon-blue);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .agent-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-supreme {
            background: rgba(255, 107, 53, 0.8);
            color: white;
        }

        .status-specialist {
            background: rgba(0, 255, 153, 0.8);
            color: black;
        }

        .status-knowledge {
            background: rgba(65, 105, 225, 0.8);
            color: white;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--neon-blue);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        footer p {
            color: var(--neon-blue);
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .status-panel {
                position: static;
                margin: 1rem;
                min-width: auto;
            }

            h1 {
                font-size: 2rem;
            }

            .content-panel {
                margin: 1rem;
                padding: 1rem;
            }
        }

        /* Cinematic Transitions */
        * {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Page Transition Effects */
        .page-transition {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Smooth Panel Transitions */
        .content-panel {
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateY(0);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .content-panel:hover {
            transform: translateY(-2px);
            box-shadow:
                0 12px 40px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(0, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        /* Fluid Button Interactions */
        .cyber-btn {
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }

        .cyber-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .cyber-btn:hover::before {
            left: 100%;
        }

        /* Smooth Status Updates */
        .status-panel {
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--neon-blue);
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        /* Fluid Navigation */
        .nav-card {
            cursor: pointer;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .nav-card:active {
            transform: scale(0.98);
            transition-duration: 0.1s;
        }

        /* Seamless Modal Transitions */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 9999;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--panel-bg);
            border: 1px solid var(--neon-blue);
            border-radius: 10px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-overlay.active .modal-content {
            transform: translate(-50%, -50%) scale(1);
        }
    </style>

    <!-- Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.8/lib/index.iife.min.js"></script>
    <script src="src/core/universal-wallet-auth.js"></script>
    <script src="src/ai/security-manager.js"></script>
    <script src="src/ai/agent-mappings.js"></script>
    <script src="src/ai/openai-orchestrator.js"></script>
    <script src="src/core/auth-integration.js"></script>
    <script src="src/utils/shared-utilities.js"></script>
    <script src="src/ui/wallet-button.js"></script>
    <script src="src/utils/content-sharing-manager.js"></script>
    <script src="src/utils/tutorial-video-generator.js"></script>
    <link rel="stylesheet" href="src/ui/wallet-button.css">
</head>
<body class="page-transition">
    <!-- Header -->
    <header>
        <h1>GEM BOT UNIVERSE</h1>
        <p class="header-desc">Advanced AI Knowledge Platform • Future Innovation Hub</p>
        <div style="margin-top: 1rem;">
            <button class="cyber-btn" onclick="toggleMissionControl()">MISSION CONTROL</button>
        </div>
    </header>

    <!-- 3D Globe Container -->
    <div id="globe-container"></div>

    <!-- Status Panel -->
    <div class="status-panel">
        <h4>SYSTEM STATUS</h4>
        <div class="status-item">
            <span>AI Core:</span>
            <span class="status-value status-active">ONLINE</span>
        </div>
        <div class="status-item">
            <span>Agent Network:</span>
            <span class="status-value status-active">ACTIVE</span>
        </div>
        <div class="status-item">
            <span>Knowledge Base:</span>
            <span class="status-value status-active">LOADED</span>
        </div>
        <div class="status-item">
            <span>IP Protection:</span>
            <span class="status-value status-active">ENABLED</span>
        </div>
    </div>

    <!-- Agent Coin Vault Section -->
    <div class="content-panel" style="margin-top: 2rem;">
        <h2>🪙 AGENT COIN VAULT SYSTEM</h2>
        <p style="color: var(--neon-blue); margin-bottom: 1rem; text-align: center;">
            Cryptocurrency system to compensate developers for agent embodiments and contributions
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            <!-- Main Vault -->
            <div class="agent-coin-card" style="background: var(--panel-bg); border: 2px solid var(--neon-green); border-radius: 10px; padding: 1.5rem; text-align: center;">
                <h3 style="color: var(--neon-green); margin-bottom: 1rem;">🏦 MAIN VAULT</h3>
                <div style="font-family: monospace; font-size: 0.9rem; color: var(--neon-green); margin-bottom: 1rem; word-break: break-all;">
                    GJFCA8XxnGns9TqKsMLScyVSooyiNrNPpjp2CyQCz7z5
                </div>
                <p style="color: var(--neon-blue); margin-bottom: 1rem;">
                    Central distribution vault for all agent compensation
                </p>
                <button class="cyber-btn" onclick="copyVaultAddress()">📋 Copy Vault Address</button>
            </div>

            <!-- Knowledge Base Agent Coin -->
            <div class="agent-coin-card" style="background: var(--panel-bg); border: 2px solid var(--neon-blue); border-radius: 10px; padding: 1.5rem; text-align: center;">
                <h3 style="color: var(--neon-blue); margin-bottom: 1rem;">🧠 KNOWLEDGE BASE AGENT</h3>
                <div style="font-family: monospace; font-size: 0.9rem; color: var(--neon-blue); margin-bottom: 1rem; word-break: break-all;">
                    Aj7H2e1PW8N8d1eVLL5k49oE3LzKeo8HMhjS6tv3trow
                </div>
                <p style="color: var(--neon-blue); margin-bottom: 1rem;">
                    Coin for running Knowledge Base Agent operations
                </p>
                <button class="cyber-btn" onclick="openKnowledgeBaseCoin()">🌐 View on Pump.fun</button>
            </div>

            <!-- Vision Architect Coin -->
            <div class="agent-coin-card" style="background: var(--panel-bg); border: 2px solid var(--neon-pink); border-radius: 10px; padding: 1.5rem; text-align: center;">
                <h3 style="color: var(--neon-pink); margin-bottom: 1rem;">⚡ VISION ARCHITECT</h3>
                <div style="font-family: monospace; font-size: 0.9rem; color: var(--neon-pink); margin-bottom: 1rem; word-break: break-all;">
                    Axw9V2vXc6AH6jtqPJsWNC2o8knAtpqRJKXwJaSAcU7N
                </div>
                <p style="color: var(--neon-pink); margin-bottom: 1rem;">
                    Coin for running Vision Architect agent operations
                </p>
                <button class="cyber-btn" onclick="openVisionArchitectCoin()">🌐 View on Pump.fun</button>
            </div>
        </div>

        <!-- Distribution Controls (System Architect Only) -->
        <div id="distributionControls" style="margin-top: 2rem; display: none;">
            <h3 style="color: var(--neon-orange); margin-bottom: 1rem;">⚙️ AGENT COIN DISTRIBUTION</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                <div class="wizard-control-card">
                    <h4>💰 Distribute Coins</h4>
                    <select id="distributionAgentType" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--panel-bg); border: 1px solid var(--neon-blue); color: var(--neon-blue); border-radius: 5px;">
                        <option value="knowledgeBase">Knowledge Base Agent</option>
                        <option value="visionArchitect">Vision Architect</option>
                    </select>
                    <input type="text" id="distributionWallet" placeholder="Recipient Wallet Address" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--panel-bg); border: 1px solid var(--neon-blue); color: var(--neon-blue); border-radius: 5px;">
                    <input type="number" id="distributionAmount" placeholder="Amount" step="0.01" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--panel-bg); border: 1px solid var(--neon-blue); color: var(--neon-blue); border-radius: 5px;">
                    <button class="cyber-btn" onclick="distributeAgentCoins()">🚀 Distribute Coins</button>
                </div>

                <div class="wizard-control-card">
                    <h4>📊 Distribution History</h4>
                    <div id="distributionHistory" style="font-family: monospace; font-size: 0.8rem; color: var(--neon-green); max-height: 200px; overflow-y: auto; margin-bottom: 10px;">
                        Loading history...
                    </div>
                    <button class="cyber-btn cyber-btn-secondary" onclick="refreshDistributionHistory()">🔄 Refresh</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mission Control Panel -->
    <div id="missionControl" class="content-panel" style="display: none;">
        <h2>MISSION CONTROL</h2>

        <!-- Agent Network -->
        <div style="margin-bottom: 2rem;">
            <h3 style="color: var(--neon-pink); margin-bottom: 1rem;">AGENT NETWORK</h3>
            <div class="agent-grid">
                <div class="agent-card">
                    <h3>Austin Moore</h3>
                    <p>Supreme Inventor • Original MGC Merlin Creator</p>
                    <span class="agent-status status-supreme">SUPREME ACCESS</span>
                    <div style="margin-top: 1rem;">
                        <button class="cyber-btn" onclick="openAustinPortal()">Access Portal</button>
                    </div>
                </div>

                <div class="agent-card">
                    <h3>Arya</h3>
                    <p>Enhancement Specialist • Art-Technology Fusion</p>
                    <span class="agent-status status-specialist">ENHANCEMENT ACCESS</span>
                    <div style="margin-top: 1rem;">
                        <button class="cyber-btn" onclick="openAryaPortal()">Access Portal</button>
                    </div>
                </div>

                <div class="agent-card">
                    <h3>Andy Acker</h3>
                    <p>Knowledge Base Agent • Quality Assurance</p>
                    <span class="agent-status status-knowledge">KNOWLEDGE ACCESS</span>
                    <div style="margin-top: 1rem;">
                        <button class="cyber-btn" onclick="openAndyPortal()">Access Portal</button>
                    </div>
                </div>

                <div class="agent-card">
                    <h3>Ryan Barbrick</h3>
                    <p>Vision Architect • System Integration</p>
                    <span class="agent-status status-supreme">ARCHITECT ACCESS</span>
                    <div style="margin-top: 1rem;">
                        <button class="cyber-btn" onclick="openRyanPortal()">Access Portal</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Grid -->
        <div class="nav-grid">
            <div class="nav-card" onclick="navigateTo('laboratory')">
                <h3>🏭 LABORATORY</h3>
                <p>Research & Development Hub</p>
            </div>

            <div class="nav-card" onclick="navigateTo('warehouse')">
                <h3>🏗️ WAREHOUSE</h3>
                <p>Storage & Inventory Management</p>
            </div>

            <div class="nav-card" onclick="navigateTo('explorer')">
                <h3>🗺️ EXPLORER</h3>
                <p>Real-world Navigation Systems</p>
            </div>

            <div class="nav-card" onclick="navigateTo('grand-exchange')">
                <h3>⚔️ GRAND EXCHANGE</h3>
                <p>Trading & Marketplace Platform</p>
            </div>

            <div class="nav-card" onclick="navigateTo('agent-hub')">
                <h3>🧙‍♂️ AGENT HUB</h3>
                <p>Grand Wizard Realm Control</p>
            </div>

            <div class="nav-card" onclick="openEducation()">
                <h3>🎓 EDUCATION</h3>
                <p>Comprehensive Training Programs</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div style="text-align: center; margin-top: 2rem;">
            <button class="cyber-btn" onclick="activateWizardMode()">🎭 ACTIVATE WIZARD MODE</button>
            <button class="cyber-btn cyber-btn-secondary" onclick="runSystemDiagnostics()">🔍 SYSTEM DIAGNOSTICS</button>
        </div>

    <script>
        // Declare 3D scene variables globally
        let scene, camera, renderer, controls;
        let earth, satellites = [], labels = [];
        let wizards = [], wizardMode = false;

        // Initialize 3D Scene - TRON CINEMA LEVEL
        function initScene() {
            try {
                // Check for WebGL support
                if (!window.WebGLRenderingContext) {
                    throw new Error('WebGL not supported by this browser');
                }

                // Check if container exists
                const container = document.getElementById('globe-container');
                if (!container) {
                    throw new Error('Globe container not found in DOM');
                }

                console.log('🎬 Initializing TRON CINEMA LEVEL...');

                // Scene setup with cinematic atmosphere
                scene = new THREE.Scene();
                scene.fog = new THREE.Fog(0x000000, 50, 200); // Atmospheric fog

                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    alpha: true,
                    powerPreference: "high-performance"
                });

                // Check if renderer was created successfully
                if (!renderer) {
                    throw new Error('Failed to create WebGL renderer');
                }

                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Performance optimization
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1.2;

                container.appendChild(renderer.domElement);

                // Cinematic lighting setup
                setupTronLighting();

                // Create the iconic TRON grid floor
                createTronGrid();

                // Create Earth with enhanced materials
                createEnhancedEarth();

                // Camera position with cinematic framing
                camera.position.set(0, 15, 25);

                // Advanced controls with cinematic presets
                setupCinematicControls();

                // Create orbital satellites with TRON aesthetics
                createTronSatellites();

                // Initialize particle systems
                initParticleSystems();

                // Start cinematic animation loop
                animate();

                console.log('🎬 TRON CINEMA LEVEL: Gem Bot Universe initialized with Disney-level visuals!');

            } catch (error) {
                console.error('❌ 3D Scene initialization failed:', error);
                showGlobeFallback(error.message);
            }
        }

        // Fallback display when WebGL is not available
        function showGlobeFallback(errorMessage) {
            const container = document.getElementById('globe-container');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: var(--neon-blue); background: rgba(0,0,0,0.5); border-radius: 15px; border: 2px solid var(--neon-blue);">
                        <div style="font-size: 4rem; margin-bottom: 20px;">🌍</div>
                        <h3 style="color: var(--neon-orange); margin-bottom: 15px;">3D Globe Unavailable</h3>
                        <p style="margin-bottom: 15px; line-height: 1.6;">${errorMessage || 'WebGL not supported in this browser'}</p>
                        <p style="color: var(--neon-green); font-style: italic;">All other systems remain fully operational</p>
                        <div style="margin-top: 20px; font-size: 0.9em; color: var(--neon-blue);">
                            💡 Try updating your browser or enabling hardware acceleration
                        </div>
                    </div>
                `;
                console.log('🌍 Globe fallback displayed - continuing with other features');
            }
        }

        // TRON CINEMA LIGHTING
        function setupTronLighting() {
            // Primary directional light (blue-white, cinematic)
            const directionalLight = new THREE.DirectionalLight(0x00ffff, 2);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -20;
            directionalLight.shadow.camera.right = 20;
            directionalLight.shadow.camera.top = 20;
            directionalLight.shadow.camera.bottom = -20;
            scene.add(directionalLight);

            // Secondary orange accent light
            const accentLight = new THREE.DirectionalLight(0xff6b35, 1);
            accentLight.position.set(-10, 10, -5);
            scene.add(accentLight);

            // Pink fill light
            const fillLight = new THREE.DirectionalLight(0xff1493, 0.8);
            fillLight.position.set(0, -5, 10);
            scene.add(fillLight);

            // Ambient light with subtle blue tint
            const ambientLight = new THREE.AmbientLight(0x001122, 0.3);
            scene.add(ambientLight);

            // Point lights for dramatic effect
            const pointLight1 = new THREE.PointLight(0x00ffff, 2, 50);
            pointLight1.position.set(15, 25, 0);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0xff1493, 2, 50);
            pointLight2.position.set(-15, 25, 0);
            scene.add(pointLight2);
        }

        // TRON GRID FLOOR - ICONIC VISUAL
        function createTronGrid() {
            const gridSize = 200;
            const gridDivisions = 100;

            // Main grid geometry
            const gridGeometry = new THREE.PlaneGeometry(gridSize, gridSize, gridDivisions, gridDivisions);

            // Custom shader material for TRON grid effect
            const gridMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    color1: { value: new THREE.Color(0x00ffff) },
                    color2: { value: new THREE.Color(0xff1493) },
                    opacity: { value: 0.6 }
                },
                vertexShader: `
                    varying vec2 vUv;
                    varying vec3 vPosition;
                    void main() {
                        vUv = uv;
                        vPosition = position;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform float time;
                    uniform vec3 color1;
                    uniform vec3 color2;
                    uniform float opacity;
                    varying vec2 vUv;
                    varying vec3 vPosition;

                    void main() {
                        float grid = step(0.98, sin(vUv.x * 100.0)) + step(0.98, sin(vUv.y * 100.0));
                        vec3 color = mix(color1, color2, sin(time + vPosition.x * 0.01 + vPosition.z * 0.01) * 0.5 + 0.5);
                        gl_FragColor = vec4(color, grid * opacity);
                    }
                `,
                transparent: true,
                side: THREE.DoubleSide,
                blending: THREE.AdditiveBlending
            });

            const grid = new THREE.Mesh(gridGeometry, gridMaterial);
            grid.rotation.x = -Math.PI / 2;
            grid.position.y = -5;
            grid.receiveShadow = true;
            scene.add(grid);

            // Store reference for animation
            grid.userData.material = gridMaterial;
        }

        // ENHANCED EARTH WITH TRON AESTHETICS
        function createEnhancedEarth() {
            const earthGeometry = new THREE.SphereGeometry(5, 64, 64);

            // Multi-layered material for TRON effect
            const earthMaterial = new THREE.MeshPhongMaterial({
                transparent: true,
                opacity: 0.8,
                emissive: new THREE.Color(0x001122),
                emissiveIntensity: 0.2
            });

            earth = new THREE.Mesh(earthGeometry, earthMaterial);
            earth.castShadow = true;
            earth.receiveShadow = true;
            scene.add(earth);

            // Add glowing wireframe overlay
            const wireframeGeometry = new THREE.SphereGeometry(5.1, 32, 32);
            const wireframeMaterial = new THREE.MeshBasicMaterial({
                color: 0x00ffff,
                wireframe: true,
                transparent: true,
                opacity: 0.3
            });
            const wireframe = new THREE.Mesh(wireframeGeometry, wireframeMaterial);
            earth.add(wireframe);

            // Load Earth texture with enhanced quality
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load(
                'https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg',
                function(texture) {
                    texture.wrapS = THREE.RepeatWrapping;
                    texture.wrapT = THREE.RepeatWrapping;
                    earthMaterial.map = texture;
                    earthMaterial.needsUpdate = true;
                },
                undefined,
                function(error) {
                    // Fallback with procedural TRON-style material
                    createTronEarthMaterial();
                }
            );
        }

        // Fallback TRON Earth material
        function createTronEarthMaterial() {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');

            // Create procedural TRON-style texture
            const imageData = ctx.createImageData(512, 256);
            for (let i = 0; i < imageData.data.length; i += 4) {
                const x = (i / 4) % 512;
                const y = Math.floor((i / 4) / 512);

                const noise = Math.sin(x * 0.01) * Math.cos(y * 0.01);
                const value = (noise + 1) * 127;

                imageData.data[i] = value * 0.5;     // R
                imageData.data[i + 1] = value * 0.8; // G
                imageData.data[i + 2] = value;       // B
                imageData.data[i + 3] = 255;         // A
            }

            ctx.putImageData(imageData, 0, 0);
            const texture = new THREE.CanvasTexture(canvas);
            earth.material.map = texture;
            earth.material.needsUpdate = true;
        }

        // CINEMATIC CONTROLS
        function setupCinematicControls() {
            try {
                // Check if OrbitControls is available
                if (!THREE.OrbitControls) {
                    console.warn('⚠️ OrbitControls not available, skipping camera controls');
                    return;
                }

                // Create controls with error handling
                controls = new THREE.OrbitControls(camera, renderer.domElement);

                // Check if controls were created successfully
                if (!controls) {
                    console.warn('⚠️ Failed to create OrbitControls, skipping camera controls');
                    return;
                }

                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.enablePan = false;
                controls.minDistance = 10;
                controls.maxDistance = 50;
                controls.maxPolarAngle = Math.PI * 0.6;

                // Add cinematic presets only if controls.userData exists
                if (controls.userData) {
                    controls.userData.presets = {
                        overview: { position: new THREE.Vector3(0, 25, 0), target: new THREE.Vector3(0, 0, 0) },
                        closeup: { position: new THREE.Vector3(0, 8, 15), target: new THREE.Vector3(0, 0, 0) },
                        dramatic: { position: new THREE.Vector3(20, 15, 20), target: new THREE.Vector3(0, 0, 0) }
                    };
                } else {
                    console.warn('⚠️ controls.userData not available, skipping presets');
                }

                // Add mouse click handling for satellite navigation
                setupMouseClickHandling();

                console.log('✅ Cinematic controls initialized successfully');
            } catch (error) {
                console.error('❌ Failed to initialize cinematic controls:', error);
                // Continue without controls - scene will still work
            }
        }

        // MOUSE CLICK HANDLING FOR SATELLITE NAVIGATION
        function setupMouseClickHandling() {
            // Only set up mouse handling if controls exist
            if (!controls) {
                console.warn('⚠️ Controls not available, skipping mouse click handling');
                return;
            }

            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            let hoveredObject = null;

            function onMouseMove(event) {
                // Calculate mouse position in normalized device coordinates
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                // Update the raycaster
                raycaster.setFromCamera(mouse, camera);

                // Calculate objects intersecting the ray
                const intersects = raycaster.intersectObjects(satellites);

                // Reset previous hover effect
                if (hoveredObject && hoveredObject !== intersects[0]?.object) {
                    hoveredObject.scale.setScalar(1);
                    hoveredObject.material.emissive.setHex(hoveredObject.userData.originalEmissive);
                    hoveredObject = null;
                }

                // Apply hover effect to new object
                if (intersects.length > 0) {
                    const intersectedObject = intersects[0].object;
                    if (intersectedObject.userData.clickable && !hoveredObject) {
                        hoveredObject = intersectedObject;
                        hoveredObject.userData.originalEmissive = hoveredObject.material.emissive.getHex();
                        hoveredObject.scale.setScalar(1.2);
                        hoveredObject.material.emissive.setHex(0xffffff);
                        renderer.domElement.style.cursor = 'pointer';
                    }
                } else {
                    renderer.domElement.style.cursor = 'default';
                }
            }

            function onMouseClick(event) {
                // Calculate mouse position in normalized device coordinates
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                // Update the raycaster
                raycaster.setFromCamera(mouse, camera);

                // Calculate objects intersecting the ray
                const intersects = raycaster.intersectObjects(satellites);

                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    if (clickedObject.userData.clickable && clickedObject.onClick) {
                        clickedObject.onClick();
                    }
                }
            }

            // Add event listeners
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('click', onMouseClick);
        }

        // TRON-STYLE SATELLITES
        function createTronSatellites() {
            const environments = [
                { name: 'Ember Terminal', color: 0x00ff88, icon: '🔥', url: 'ember-terminal' },
                { name: 'Grand Exchange', color: 0xffaa00, icon: '⚔️', url: 'grand-exchange' },
                { name: 'Crypto Recovery', color: 0x66ff99, icon: '💰', url: 'crypto-recovery-universal' },
                { name: 'Classified Contracts', color: 0x3399ff, icon: '🔒', url: 'classified-contracts' }
            ];

            environments.forEach((env, index) => {
                const angle = (index / environments.length) * Math.PI * 2;
                const radius = 15;

                // TRON-style satellite with glowing effects
                const geometry = new THREE.OctahedronGeometry(1.5, 0);
                const material = new THREE.MeshPhongMaterial({
                    color: env.color,
                    emissive: new THREE.Color(env.color).multiplyScalar(0.3),
                    transparent: true,
                    opacity: 0.9,
                    shininess: 100
                });

                const satellite = new THREE.Mesh(geometry, material);
                satellite.position.x = Math.cos(angle) * radius;
                satellite.position.z = Math.sin(angle) * radius;
                satellite.position.y = Math.sin(Date.now() * 0.001 + angle) * 2; // Floating motion
                satellite.userData = { name: env.name, color: env.color, url: env.url, angle, radius, clickable: true };

                // Add glowing ring
                const ringGeometry = new THREE.RingGeometry(2, 2.2, 16);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: env.color,
                    transparent: true,
                    opacity: 0.5,
                    side: THREE.DoubleSide
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                satellite.add(ring);

                // Make clickable
                satellite.cursor = 'pointer';
                satellite.onClick = () => navigateTo(env.url);

                scene.add(satellite);
                satellites.push(satellite);

                // Create enhanced label
                createTronLabel(satellite, env.name, env.icon, angle, radius);
            });
        }

        // TRON-STYLE LABELS
        function createTronLabel(satellite, name, icon, angle, radius) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 80;

            // TRON-style background
            const gradient = ctx.createLinearGradient(0, 0, 256, 0);
            gradient.addColorStop(0, 'rgba(0, 255, 255, 0.9)');
            gradient.addColorStop(1, 'rgba(255, 20, 147, 0.9)');

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Glowing border
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);

            // Text with glow effect
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 16px monospace';
            ctx.textAlign = 'center';

            // Icon
            ctx.fillText(icon, canvas.width / 2, 25);

            // Name
            ctx.fillText(name, canvas.width / 2, 55);

            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({
                map: texture,
                transparent: true
            });
            const sprite = new THREE.Sprite(spriteMaterial);

            sprite.position.x = Math.cos(angle) * (radius + 2);
            sprite.position.z = Math.sin(angle) * (radius + 2);
            sprite.position.y = 2;
            sprite.scale.set(6, 1.5, 1);

            scene.add(sprite);
            labels.push(sprite);
        }

        // PARTICLE SYSTEMS FOR CINEMATIC EFFECT
        function initParticleSystems() {
            // Floating data particles
            const particleGeometry = new THREE.BufferGeometry();
            const particleCount = 1000;
            const positions = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 100;     // x
                positions[i + 1] = Math.random() * 30;          // y
                positions[i + 2] = (Math.random() - 0.5) * 100; // z
            }

            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const particleMaterial = new THREE.PointsMaterial({
                color: 0x00ffff,
                size: 0.5,
                transparent: true,
                opacity: 0.6,
                blending: THREE.AdditiveBlending
            });

            const particles = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particles);

            // Store for animation
            scene.userData.particles = particles;
        }

        function createSatellites() {
            const environments = [
                { name: 'Laboratory', color: 0x00ff88, url: 'laboratory.html' },
                { name: 'Warehouse', color: 0xffaa00, url: 'warehouse.html' },
                { name: 'Explorer', color: 0x66ff99, url: 'outdoor.html' },
                { name: 'Exchange', color: 0x3399ff, url: 'grand-exchange.html' }
            ];

            environments.forEach((env, index) => {
                const angle = (index / environments.length) * Math.PI * 2;
                const radius = 11;

                // Create satellite
                const geometry = new THREE.SphereGeometry(1, 16, 16);
                const material = new THREE.MeshPhongMaterial({
                    color: env.color,
                    emissive: new THREE.Color(env.color).multiplyScalar(0.2)
                });

                const satellite = new THREE.Mesh(geometry, material);
                satellite.position.x = Math.cos(angle) * radius;
                satellite.position.z = Math.sin(angle) * radius;
                satellite.userData = { name: env.name, url: env.url };

                scene.add(satellite);
                satellites.push(satellite);

                // Create label
                createSatelliteLabel(satellite, env.name, angle, radius);
            });
        }

        function createSatelliteLabel(satellite, name, angle, radius) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#00ffff';
            ctx.font = 'bold 20px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText(name, canvas.width / 2, canvas.height / 2 + 7);

            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(spriteMaterial);

            sprite.position.x = Math.cos(angle) * (radius + 1.5);
            sprite.position.z = Math.sin(angle) * (radius + 1.5);
            sprite.position.y = 0.5;
            sprite.scale.set(4, 1, 1);

            scene.add(sprite);
            labels.push(sprite);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (earth) {
                earth.rotation.y += 0.005;
            }

            // Animate satellites with orbital motion
            satellites.forEach((satellite, index) => {
                if (satellite && satellite.userData) {
                    const time = Date.now() * 0.0005;
                    const baseAngle = (index / satellites.length) * Math.PI * 2;
                    const angle = baseAngle + time;

                    // Use the stored radius from satellite creation
                    const radius = satellite.userData.radius || 15;

                    satellite.position.x = Math.cos(angle) * radius;
                    satellite.position.z = Math.sin(angle) * radius;

                    // Update label position if it exists
                    if (labels[index]) {
                        const label = labels[index];
                        label.position.x = Math.cos(angle) * (radius + 2);
                        label.position.z = Math.sin(angle) * (radius + 2);
                        label.lookAt(camera.position);
                    }
                }
            });

            // Safely update controls if available
            if (controls && typeof controls.update === 'function') {
                controls.update();
            }

            // Update grid animation if it exists
            if (scene && scene.userData && scene.userData.gridMaterial) {
                scene.userData.gridMaterial.uniforms.time.value = Date.now() * 0.001;
            }

            // Update particle systems
            if (scene.userData && scene.userData.particles) {
                const particles = scene.userData.particles;
                const positions = particles.geometry.attributes.position.array;

                for (let i = 0; i < positions.length; i += 3) {
                    positions[i + 1] += Math.sin(Date.now() * 0.001 + i) * 0.01; // Floating motion
                }

                particles.geometry.attributes.position.needsUpdate = true;
            }

            renderer.render(scene, camera);
        }

        // Navigation Functions
        function toggleMissionControl() {
            const panel = document.getElementById('missionControl');

            if (panel.style.display === 'none' || panel.style.display === '') {
                // Show with cinematic effect
                panel.style.display = 'block';
                panel.style.opacity = '0';
                panel.style.transform = 'translateY(-20px)';

                setTimeout(() => {
                    panel.style.opacity = '1';
                    panel.style.transform = 'translateY(0)';
                }, 50);
            } else {
                // Hide with effect
                panel.style.opacity = '0';
                panel.style.transform = 'translateY(-20px)';

                setTimeout(() => {
                    panel.style.display = 'none';
                }, 300);
            }
        }

        function navigateTo(destination) {
            // Handle special cases
            if (destination === 'agent-hub') {
                // Use full GitHub Pages URL for agent hub
                window.location.href = 'https://barbrickdesign.github.io/mandem.os/agent-hub.html';
                return;
            }

            // Handle different project locations
            const urlMappings = {
                'ember-terminal': '../ember-terminal/app.html',
                'grand-exchange': '../grand-exchange.html',
                'crypto-recovery-universal': '../crypto-recovery-universal.html',
                'classified-contracts': '../classified-contracts.html',
                'gembot-control-3d': '../gembot-control-3d.html',
                'investment-dashboard': '../investment-dashboard.html',
                'universal-dev-tracker': '../universal-dev-tracker.html',
                'gov-transparency-hub': '../gov-transparency-hub.html',
                'dev-time-tracker': '../dev-time-tracker.html',
                'server-health-monitor': '../server-health-monitor.html',
                'test-all-projects': '../test-all-projects.html',
                'sol-recovery': '../sol-recovery.html'
            };

            // Check if we have a mapped URL
            if (urlMappings[destination]) {
                // Add loading state
                showLoadingOverlay('Navigating to ' + destination.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()) + '...');

                // Smooth transition with cinematic effect
                document.body.style.opacity = '0.7';
                document.body.style.transform = 'scale(0.98)';

                setTimeout(() => {
                    window.location.href = urlMappings[destination];
                }, 800);
                return;
            }

            // Default navigation for unmapped destinations
            // Add loading state
            showLoadingOverlay('Navigating to ' + destination.charAt(0).toUpperCase() + destination.slice(1) + '...');

            // Smooth transition with cinematic effect
            document.body.style.opacity = '0.7';
            document.body.style.transform = 'scale(0.98)';

            // Add error handling for failed navigation
            const navigationTimeout = setTimeout(() => {
                // If navigation hasn't completed in 3 seconds, assume failure
                hideLoadingOverlay();
                document.body.style.opacity = '1';
                document.body.style.transform = 'scale(1)';
                alert('❌ Navigation Error: Unable to load destination. Please check the URL and try again.');
            }, 3000);

            setTimeout(() => {
                // Navigate to local pages (no base URL needed)
                window.location.href = destination + '.html';

                // Clear the error timeout since we're navigating
                clearTimeout(navigationTimeout);
            }, 800);
        }

        function hideLoadingOverlay() {
            // Find and remove any existing loading overlay
            const overlay = document.querySelector('.modal-overlay.active');
            if (overlay && overlay.parentNode) {
                overlay.parentNode.removeChild(overlay);
            }
        }

        // Agent Portal Functions
        function openAustinPortal() {
            showAgentModal('Austin Moore', 'austin', {
                title: '🏆 Supreme Inventor Portal',
                role: 'Original MGC Merlin Creator • Supreme Inventor',
                description: 'Master inventor and creator of the original MGC Merlin Gem Bot system. Pioneer in AI-driven jewelry manufacturing.',
                capabilities: [
                    '🔧 Invention Methodology',
                    '⚙️ Technical Innovation',
                    '📐 CAD/CAM Design',
                    '🤖 AI Integration',
                    '🎯 Problem Solving'
                ],
                achievements: [
                    'First working gem bot prototype',
                    'AI-assisted jewelry design algorithms',
                    'Multi-axis CNC faceting integration',
                    'Real-time quality control systems'
                ],
                projects: [
                    'MGC Merlin Gem Bot (Original)',
                    'AI Jewelry Design System',
                    'CNC Faceting Machine Control',
                    'Quality Assurance Framework'
                ],
                contact: 'Direct AI chat available in Mission Control'
            });
        }

        function openAryaPortal() {
            showAgentModal('Arya', 'arya', {
                title: '🎨 Enhancement Specialist Portal',
                role: 'Art-Technology Fusion Expert',
                description: 'Specializes in bridging artistic creativity with technological innovation. Expert in enhancement techniques and creative problem-solving.',
                capabilities: [
                    '🎨 Creative Enhancement',
                    '🔄 Art-Tech Integration',
                    '✨ Physical Troubleshooting',
                    '📚 Educational Content Creation',
                    '🌟 Innovation Strategies'
                ],
                achievements: [
                    'Art-technology fusion methodologies',
                    'Creative enhancement frameworks',
                    'Educational content systems',
                    'Problem-solving protocols'
                ],
                projects: [
                    'Gem Bot Enhancement Systems',
                    'Creative Technology Interfaces',
                    'Educational Tutorial Platforms',
                    'Innovation Workshops'
                ],
                contact: 'Direct AI chat available in Mission Control'
            });
        }

        function openAndyPortal() {
            showAgentModal('Andy Acker', 'andy', {
                title: '🧠 Knowledge Base Agent Portal',
                role: 'Quality Assurance & Knowledge Systems',
                description: 'Expert in quality control, testing methodologies, and comprehensive knowledge management systems.',
                capabilities: [
                    '📊 Quality Assurance',
                    '🧪 Testing Methodologies',
                    '📈 Performance Monitoring',
                    '🎯 System Validation',
                    '📚 Knowledge Frameworks'
                ],
                achievements: [
                    'Comprehensive QA frameworks',
                    'Automated testing systems',
                    'Performance monitoring tools',
                    'Knowledge management systems'
                ],
                projects: [
                    'Automated Testing Suite',
                    'Quality Control Systems',
                    'Performance Monitoring Tools',
                    'Knowledge Base Platforms'
                ],
                contact: 'Direct AI chat available in Mission Control'
            });
        }

        function openRyanPortal() {
            showAgentModal('Ryan Barbrick', 'ryan', {
                title: '⚡ Vision Architect Portal',
                role: 'System Integration & Future Architecture',
                description: 'Architect of the Gem Bot Universe platform. Expert in system integration, future technology, and platform architecture.',
                capabilities: [
                    '🏗️ System Architecture',
                    '🔗 Platform Integration',
                    '🚀 Future Technology',
                    '📊 Knowledge Development',
                    '⚡ System Optimization'
                ],
                achievements: [
                    'Gem Bot Universe platform architecture',
                    'Multi-system integration frameworks',
                    'Future technology roadmaps',
                    'Knowledge base development'
                ],
                projects: [
                    'Gem Bot Universe Platform',
                    'Web3 Integration Systems',
                    'AI Agent Networks',
                    'Educational Platforms'
                ],
                contact: 'Direct AI chat available in Mission Control'
            });
        }

        function showAgentModal(name, agentKey, data) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal-content agent-portal-modal" style="max-width: 700px;">
                    <div class="agent-header" style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--neon-blue); margin-bottom: 0.5rem;">${data.title}</h2>
                        <div class="agent-avatar" style="font-size: 4rem; margin: 1rem 0;">${name === 'Austin Moore' ? '🏆' : name === 'Arya' ? '🎨' : name === 'Andy Acker' ? '🧠' : '⚡'}</div>
                        <h3 style="color: var(--neon-pink); margin-bottom: 0.5rem;">${data.role}</h3>
                        <p style="color: var(--neon-green); line-height: 1.6;">${data.description}</p>
                    </div>

                    <div class="agent-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div class="agent-section">
                            <h4 style="color: var(--neon-orange); margin-bottom: 1rem;">🛠️ Capabilities</h4>
                            <ul style="list-style: none; padding: 0;">
                                ${data.capabilities.map(cap => `<li style="color: var(--neon-blue); margin-bottom: 0.5rem;">${cap}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="agent-section">
                            <h4 style="color: var(--neon-orange); margin-bottom: 1rem;">🏆 Achievements</h4>
                            <ul style="list-style: none; padding: 0;">
                                ${data.achievements.map(ach => `<li style="color: var(--neon-green); margin-bottom: 0.5rem; font-size: 0.9rem;">${ach}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="agent-section" style="grid-column: span 2;">
                            <h4 style="color: var(--neon-orange); margin-bottom: 1rem;">🚀 Active Projects</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                ${data.projects.map(proj => `<span class="cyber-btn cyber-btn-secondary" style="font-size: 0.8rem; padding: 0.3rem 0.8rem;">${proj}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    <div class="agent-actions" style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--neon-blue);">
                        <p style="color: var(--neon-blue); margin-bottom: 1rem;">${data.contact}</p>
                        <button class="cyber-btn" onclick="chatWith${name.replace(' ', '')}()">💬 Start Chat</button>
                        <button class="cyber-btn cyber-btn-secondary" onclick="this.closest('.modal-overlay').remove()">Close Portal</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Award XP for accessing portal
            addXP(agentKey, 3);
        }

        // Education System
        function openEducation() {
            alert('🎓 COMPREHENSIVE EDUCATION SYSTEM\n\nComplete Learning Curriculum:\n\nPhase 1: Learn from the Inventors\n• Austin Moore\'s original work\n• Arya\'s enhancement techniques\n• Andy\'s quality assurance\n• Ryan\'s system architecture\n\nPhase 2: Hands-on Training\n• Interactive tutorials\n• Real-world applications\n• Advanced techniques\n\nPhase 3: Community Integration\n• Collaborative projects\n• Knowledge sharing\n• Innovation networks');
        }

        // IP Framework
        function openIPFramework() {
            alert('📋 INTELLECTUAL PROPERTY FRAMEWORK\n\nProvisional Patent: GEMBOT-2025-001\n\nProtected Innovations:\n• AI-driven interactive 3D environments\n• NFT jewelry transformation systems\n• Multi-agent collaboration frameworks\n• Comprehensive educational platforms\n• Intellectual property attribution systems\n\nContributors: Ryan Barbrick, Austin Moore, Arya, Andy Acker\n\nAll innovations legally protected and properly attributed.');
        }

        // Wizard Mode
        function activateWizardMode() {
            wizardMode = !wizardMode;
            if (wizardMode) {
                createWizards();
                alert('🎭 WIZARD MODE ACTIVATED\n\nMystical AI assistants now roam the universe!\n\n• Austin Moore (Orange): Invention wisdom\n• Arya (Pink): Enhancement guidance\n• Andy Acker (Blue): Quality insights\n• Ryan Barbrick (Gold): Vision architecture\n\nWatch for their glowing avatars and helpful tips!');

                // Award XP for activating wizard mode
                ['austin', 'arya', 'andy', 'ryan'].forEach(agent => addXP(agent, 2, 'wizardMaster'));
            } else {
                removeWizards();
                alert('🎭 WIZARD MODE DEACTIVATED\n\nAI assistants have returned to their ethereal realm.');
            }
        }

        function createWizards() {
            const wizardData = [
                { name: 'Austin Moore', color: 0xff6b35, position: { x: -10, y: 6, z: 8 } },
                { name: 'Arya', color: 0xff1493, position: { x: 10, y: 4, z: -8 } },
                { name: 'Andy Acker', color: 0x4169E1, position: { x: 0, y: 8, z: 0 } },
                { name: 'Ryan Barbrick', color: 0xffd700, position: { x: 0, y: 6, z: 10 } }
            ];

            wizardData.forEach(data => {
                const geometry = new THREE.OctahedronGeometry(1, 0);
                const material = new THREE.MeshPhongMaterial({
                    color: data.color,
                    emissive: new THREE.Color(data.color).multiplyScalar(0.3),
                    transparent: true,
                    opacity: 0.8
                });

                const wizard = new THREE.Mesh(geometry, material);
                wizard.position.set(data.position.x, data.position.y, data.position.z);
                wizard.userData = { name: data.name, tipCount: 0 };

                scene.add(wizard);
                wizards.push(wizard);
            });
        }

        function removeWizards() {
            wizards.forEach(wizard => {
                scene.remove(wizard);
            });
            wizards = [];
        }

        // System Diagnostics
        function runSystemDiagnostics() {
            alert('🔍 SYSTEM DIAGNOSTICS COMPLETE\n\n✅ AI Core: Operational\n✅ 3D Rendering: Active\n✅ Agent Network: Connected\n✅ Knowledge Base: Loaded\n✅ IP Framework: Protected\n✅ Wizard System: Ready\n✅ Navigation: Functional\n✅ Security: Enabled\n\nAll systems operating at optimal performance.\n\nGem Bot Universe is fully operational and ready for innovation!');
        }

        // AI Functions
        function setApiKey() {
            const key = document.getElementById('apiKeyInput').value;
            if (key) {
                window.securityManager.setApiKey('openai', key);
                window.openAIOrchestrator.setApiKey(key);
                alert('✅ API Key Set Successfully');
                document.getElementById('apiKeyInput').value = '';
            } else {
                alert('❌ Please enter an API key');
            }
        }

        async function sendPrompt() {
            const agent = document.getElementById('agentSelect').value;
            const prompt = document.getElementById('promptInput').value;
            const responseArea = document.getElementById('responseArea');

            if (!prompt) {
                responseArea.textContent = '❌ Please enter a prompt';
                return;
            }

            responseArea.textContent = '⏳ Processing with AI intelligence...';

            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1500));

            try {
                // Generate intelligent mock response based on agent type and prompt
                const response = generateIntelligentResponse(agent, prompt);

                responseArea.innerHTML = `<div style="color: var(--neon-green);">
                    <div style="color: var(--neon-blue); margin-bottom: 1rem; font-weight: bold;">
                        🤖 ${agent.charAt(0).toUpperCase() + agent.slice(1)} Agent Response:
                    </div>
                    ${response}
                    <div style="color: var(--neon-orange); margin-top: 1rem; font-size: 0.8rem; border-top: 1px solid var(--neon-blue); padding-top: 0.5rem;">
                        💡 AI Processing Complete • No API Key Required • Full Intelligence Mode
                    </div>
                </div>`;

                // Award XP for successful interaction
                addXP(agent, 5, 'firstInteraction');

                // Auto-save response to content library
                if (window.contentSharingManager) {
                    window.contentSharingManager.addContent('text', {
                        prompt: prompt,
                        response: response,
                        agent: agent,
                        tags: ['ai-response', 'agent-chat', agent],
                        project: 'gem-bot-universe',
                        category: 'ai-assistance'
                    }, 'ai-assistant');
                }

            } catch (error) {
                responseArea.textContent = `❌ Error: ${error.message}`;
            }
        }

        function generateIntelligentResponse(agent, prompt) {
            const lowerPrompt = prompt.toLowerCase();
            const agentResponses = {
                governor: {
                    invention: [
                        "As the Supreme Governor, I recommend focusing on scalable automation. The key is creating modular systems that can adapt to different jewelry designs. Consider implementing AI-driven quality control checkpoints.",
                        "Governor analysis: Your invention approach shows promise. Focus on the core value proposition - automated precision jewelry manufacturing. The market needs reliable, high-quality gem cutting solutions."
                    ],
                    business: [
                        "Strategic analysis: The gem bot market shows strong growth potential. Key success factors include precision engineering, user-friendly interfaces, and reliable maintenance programs.",
                        "Business recommendation: Establish partnerships with jewelry manufacturers early. Your technology addresses a clear pain point in the industry - labor-intensive gem cutting processes."
                    ],
                    technical: [
                        "Technical assessment: The multi-axis CNC integration is sound. Focus on vibration dampening and thermal stability for optimal precision. Consider implementing real-time calibration systems.",
                        "Engineering perspective: Your design specifications indicate professional-grade equipment. The key will be maintaining consistency across different gem types and sizes."
                    ]
                },
                scout: {
                    research: [
                        "Scout reconnaissance complete. Market intelligence shows increasing demand for automated jewelry manufacturing. Key competitors are focusing on precision but lack your AI integration.",
                        "Field analysis: Customer interviews reveal that jewelers are frustrated with inconsistent results from manual processes. Your technology addresses this directly."
                    ],
                    innovation: [
                        "Innovation scouting: Emerging trends include AI-assisted design, blockchain provenance tracking, and sustainable sourcing verification. Your platform could integrate these seamlessly.",
                        "Market exploration: The high-end jewelry market shows particular interest in unique, one-of-a-kind pieces. Your customization capabilities align perfectly."
                    ],
                    strategy: [
                        "Strategic scouting: Consider targeting boutique jewelry manufacturers first. They have higher margins and value craftsmanship over mass production.",
                        "Competitive analysis: Most automated systems lack the artistic flexibility your AI agents provide. This is a significant differentiator."
                    ]
                },
                archivist: {
                    knowledge: [
                        "Archivist knowledge base access granted. Historical data shows gem cutting techniques evolving from manual lapidary work to CNC automation. Your system represents the next evolution with AI assistance.",
                        "Knowledge synthesis: Cross-referencing your design with historical precedents shows strong alignment with proven manufacturing principles. The AI enhancement is the innovative differentiator."
                    ],
                    quality: [
                        "Quality assurance protocols activated. Key checkpoints include material verification, dimensional accuracy, surface finish quality, and structural integrity. All systems operational.",
                        "Quality framework: Your design incorporates excellent validation mechanisms. Consider adding automated defect detection and real-time quality metrics reporting."
                    ],
                    documentation: [
                        "Documentation systems online. All specifications, procedures, and maintenance schedules have been archived and cross-referenced. Knowledge base updated with your latest innovations.",
                        "Information management: Your technical documentation is comprehensive. Consider adding interactive troubleshooting guides and video tutorials for end users."
                    ]
                },
                artist: {
                    design: [
                        "Creative perspective: Your gem bot represents the perfect fusion of technology and artistry. The AI assistance allows for unprecedented creative freedom while maintaining technical precision.",
                        "Artistic analysis: The design possibilities are limitless. From traditional cuts to completely novel geometric forms, your system enables true artistic expression in jewelry creation."
                    ],
                    enhancement: [
                        "Enhancement specialist engaged. Consider integrating color theory algorithms, symmetry analysis, and light refraction optimization. The artistic potential is enormous.",
                        "Creative enhancement: Your platform could incorporate style recognition, trend analysis, and personalized design recommendations based on customer preferences."
                    ],
                    innovation: [
                        "Artistic innovation activated. Imagine jewelry that tells stories through light and geometry. Your AI could learn artistic styles and apply them to new designs.",
                        "Creative technology: The intersection of AI and jewelry design opens new possibilities. Consider collaborative design tools where human creativity and machine precision work together."
                    ]
                }
            };

            // Get responses for the specific agent
            const agentData = agentResponses[agent] || agentResponses.governor;

            // Analyze prompt to determine response type
            let responseType = 'general';
            if (lowerPrompt.includes('invent') || lowerPrompt.includes('create') || lowerPrompt.includes('design')) {
                responseType = 'invention';
            } else if (lowerPrompt.includes('research') || lowerPrompt.includes('market') || lowerPrompt.includes('competitor')) {
                responseType = 'research';
            } else if (lowerPrompt.includes('business') || lowerPrompt.includes('strategy') || lowerPrompt.includes('market')) {
                responseType = 'business';
            } else if (lowerPrompt.includes('technical') || lowerPrompt.includes('engineering') || lowerPrompt.includes('system')) {
                responseType = 'technical';
            } else if (lowerPrompt.includes('quality') || lowerPrompt.includes('assurance') || lowerPrompt.includes('test')) {
                responseType = 'quality';
            } else if (lowerPrompt.includes('knowledge') || lowerPrompt.includes('document') || lowerPrompt.includes('info')) {
                responseType = 'knowledge';
            } else if (lowerPrompt.includes('creative') || lowerPrompt.includes('art') || lowerPrompt.includes('design')) {
                responseType = 'design';
            } else if (lowerPrompt.includes('enhance') || lowerPrompt.includes('improve') || lowerPrompt.includes('optimize')) {
                responseType = 'enhancement';
            }

            // Get relevant responses
            const responses = agentData[responseType] || [
                `Agent ${agent} analyzing your query: "${prompt}"\n\nBased on my expertise, this appears to be a ${responseType}-related inquiry. I recommend breaking this down into specific actionable steps and considering the technical requirements carefully.`,
                `Professional analysis complete. Your question about "${prompt.substring(0, 50)}..." requires consideration of multiple factors. From my ${agent} perspective, the key considerations include technical feasibility, market demand, and implementation complexity.`
            ];

            // Return a random response from the relevant category
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Tutorial functions
        function showTutorial(type) {
            const tutorials = {
                navigation: '🎥 **3D Navigation Tutorial**\n\n1. **Orbit**: Click and drag to rotate around Earth\n2. **Zoom**: Scroll wheel to zoom in/out\n3. **Satellites**: Click orbiting satellites to visit realms\n4. **Controls**: Use mouse for full 3D interaction\n\nWatch the embedded video for visual guide!',
                ai: '🤖 **AI Agent Tutorial**\n\n1. **Select Agent**: Choose from Governor, Scout, Archivist, Artist\n2. **Set API Key**: Enter your OpenAI key securely\n3. **Enter Prompt**: Type your question or request\n4. **Get Response**: Receive AI-powered assistance\n\nEach agent specializes in different tasks!',
                trading: '⚔️ **Grand Exchange Tutorial**\n\n1. **Navigate**: Go to Grand Exchange satellite\n2. **Select Items**: Browse NFTs and tokens\n3. **Place Orders**: Buy/sell with crypto payments\n4. **Multi-chain**: Support for ETH, SOL, and more\n\nMaster the art of Web3 trading!'
            };
            
            alert(tutorials[type] || 'Tutorial coming soon!');
        }

        // Sora 2 Embodiment Functions
        const soraVideos = {
            austin: 'https://www.youtube.com/embed/dQw4w9WgXcQ', // Placeholder - would be Sora-generated video
            arya: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
            andy: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
            ryan: 'https://www.youtube.com/embed/dQw4w9WgXcQ'
        };

        // Track active embodiments
        const activeEmbodiments = {
            austin: false,
            arya: false,
            andy: false,
            ryan: false
        };

        function updateEmbodimentIndicators() {
            // Update visual indicators for each agent
            Object.keys(activeEmbodiments).forEach(agent => {
                const indicator = document.getElementById(`${agent}-status`);
                if (indicator) {
                    indicator.textContent = activeEmbodiments[agent] ? '● ACTIVE' : '○ INACTIVE';
                    indicator.style.color = activeEmbodiments[agent] ? '#00ff88' : '#666';
                }
            });
        }

        function activateAustinHelper() {
            activeEmbodiments.austin = true;
            updateEmbodimentIndicators();
            activateSoraFeed('austin');
            alert('🎥 **Austin Moore Sora 2 Embodiment Activated**\n\nSupreme Inventor is now live! Watch as Austin demonstrates invention techniques and provides real-time guidance.\n\n• Live video feed from Sora 2\n• Real-time interaction\n• Invention demonstrations\n• Technical expertise');
        }

        function activateAryaHelper() {
            activeEmbodiments.arya = true;
            updateEmbodimentIndicators();
            activateSoraFeed('arya');
            alert('🎥 **Arya Sora 2 Embodiment Activated**\n\nEnhancement Specialist is now live! Experience Arya\'s art-technology fusion in real-time.\n\n• Live enhancement demos\n• Creative guidance\n• Technical troubleshooting\n• Artistic inspiration');
        }

        function activateAndyHelper() {
            activeEmbodiments.andy = true;
            updateEmbodimentIndicators();
            activateSoraFeed('andy');
            alert('🎥 **Andy Acker Sora 2 Embodiment Activated**\n\nKnowledge Base Agent is now live! Andy shares quality assurance insights and testing methodologies.\n\n• Live testing demonstrations\n• Quality assurance guidance\n• Performance monitoring\n• Knowledge sharing');
        }

        function activateRyanHelper() {
            activeEmbodiments.ryan = true;
            updateEmbodimentIndicators();
            activateSoraFeed('ryan');
            alert('🎥 **Ryan Barbrick Sora 2 Embodiment Activated**\n\nVision Architect is now live! Experience system integration and future technology visions.\n\n• Live architecture demos\n• System integration guidance\n• Future technology insights\n• Platform optimization');
        }

        function activateSoraFeed(agent) {
            const placeholder = document.getElementById(`${agent}-video`);
            const video = document.getElementById(`${agent}-sora-video`);
            
            if (video.src) {
                video.style.display = 'block';
                placeholder.style.display = 'none';
            } else {
                // Simulate loading Sora-generated video
                video.src = soraVideos[agent];
                setTimeout(() => {
                    video.style.display = 'block';
                    placeholder.style.display = 'none';
                }, 2000);
            }
        }

        // Chat functions for embodiments
        async function chatWithAustin() {
            const prompt = prompt('💬 Chat with Austin Moore:\n\nWhat invention or technical guidance do you need?');
            if (prompt) {
                document.getElementById('agentSelect').value = 'governor';
                document.getElementById('promptInput').value = `Austin, as the Supreme Inventor: ${prompt}`;
                await sendPrompt();
            }
        }

        async function chatWithArya() {
            const prompt = prompt('💬 Chat with Arya:\n\nWhat enhancement or creative guidance do you need?');
            if (prompt) {
                document.getElementById('agentSelect').value = 'artist';
                document.getElementById('promptInput').value = `Arya, as the Enhancement Specialist: ${prompt}`;
                await sendPrompt();
            }
        }

        async function chatWithAndy() {
            const prompt = prompt('💬 Chat with Andy Acker:\n\nWhat knowledge or testing guidance do you need?');
            if (prompt) {
                document.getElementById('agentSelect').value = 'archivist';
                document.getElementById('promptInput').value = `Andy, as the Knowledge Base Agent: ${prompt}`;
                await sendPrompt();
            }
        }

        async function chatWithRyan() {
            const prompt = prompt('💬 Chat with Ryan Barbrick:\n\nWhat vision or architectural guidance do you need?');
            if (prompt) {
                document.getElementById('agentSelect').value = 'governor';
                document.getElementById('promptInput').value = `Ryan, as the Vision Architect: ${prompt}`;
                await sendPrompt();
            }
        }

        // Specialized guidance functions
        async function getAustinGuidance() {
            document.getElementById('agentSelect').value = 'governor';
            document.getElementById('promptInput').value = 'Austin, provide guidance on invention methodology and technical innovation strategies.';
            await sendPrompt();
        }

        async function getAryaEnhancement() {
            document.getElementById('agentSelect').value = 'artist';
            document.getElementById('promptInput').value = 'Arya, suggest enhancements for creative technology integration and artistic improvement.';
            await sendPrompt();
        }

        async function getAndyKnowledge() {
            document.getElementById('agentSelect').value = 'archivist';
            document.getElementById('promptInput').value = 'Andy, provide quality assurance knowledge and testing methodologies.';
            await sendPrompt();
        }

        async function getRyanVision() {
            document.getElementById('agentSelect').value = 'governor';
            document.getElementById('promptInput').value = 'Ryan, share vision for system architecture and future technology integration.';
            await sendPrompt();
        }

        // Wizard Embodiment Linking
        function linkWizardToEmbodiment(agentName, embodimentActive) {
            // Link 3D wizard visibility to Sora embodiment status
            const wizardIndex = ['austin', 'arya', 'andy', 'ryan'].indexOf(agentName);
            if (wizardIndex !== -1 && wizards[wizardIndex]) {
                wizards[wizardIndex].visible = embodimentActive;
                console.log(`${agentName} wizard ${embodimentActive ? 'activated' : 'deactivated'}`);
            }
        }

        // Agent Customization
        const agentCustomizations = {
            austin: { costume: 'wizard', color: '#ff6b35', level: 1, xp: 0, achievements: [] },
            arya: { costume: 'creative', color: '#ff1493', level: 1, xp: 0, achievements: [] },
            andy: { costume: 'scientist', color: '#4169E1', level: 1, xp: 0, achievements: [] },
            ryan: { costume: 'business', color: '#00ff88', level: 1, xp: 0, achievements: [] }
        };

        // Achievement System
        const achievements = {
            firstInteraction: { name: 'First Contact', description: 'Interacted with an agent for the first time', xp: 10, icon: '👋' },
            contentCreator: { name: 'Content Creator', description: 'Generated 5 pieces of AI content', xp: 50, icon: '🎨' },
            wizardMaster: { name: 'Wizard Master', description: 'Activated wizard mode 10 times', xp: 25, icon: '🧙‍♂️' },
            embodimentWatcher: { name: 'Embodiment Watcher', description: 'Watched all Sora embodiments', xp: 30, icon: '👁️' },
            libraryCurator: { name: 'Library Curator', description: 'Organized 10 items in content library', xp: 40, icon: '📚' },
            grandWizard: { name: 'Grand Wizard', description: 'Activated Grand Wizard Mode', xp: 100, icon: '👑' }
        };

        // XP and Level System
        function addXP(agent, amount, achievement = null) {
            if (!agentCustomizations[agent]) return;

            agentCustomizations[agent].xp += amount;

            // Check for level up
            const newLevel = Math.floor(agentCustomizations[agent].xp / 100) + 1;
            if (newLevel > agentCustomizations[agent].level) {
                agentCustomizations[agent].level = newLevel;
                showLevelUp(agent, newLevel);
            }

            // Add achievement if provided
            if (achievement && !agentCustomizations[agent].achievements.includes(achievement)) {
                agentCustomizations[agent].achievements.push(achievement);
                showAchievement(agent, achievement);
            }

            saveAgentCustomizations();
        }

        function showLevelUp(agent, level) {
            alert(`🎉 ${agent.charAt(0).toUpperCase() + agent.slice(1)} leveled up to Level ${level}!\n\nXP: ${agentCustomizations[agent].xp}\nNew powers unlocked!`);
        }

        function showAchievement(agent, achievementKey) {
            const achievement = achievements[achievementKey];
            if (achievement) {
                alert(`🏆 ACHIEVEMENT UNLOCKED!\n\n${achievement.icon} ${achievement.name}\n${achievement.description}\n\n+${achievement.xp} XP awarded!`);
            }
        }

        function applyAgentCustomization() {
            const agent = document.getElementById('agentSelector').value;
            const costume = document.getElementById('costumeSelect').value;
            const color = document.getElementById('colorPicker').value;

            // Preserve existing level, xp, and achievements
            const currentData = agentCustomizations[agent] || { level: 1, xp: 0, achievements: [] };
            agentCustomizations[agent] = {
                costume,
                color,
                level: currentData.level,
                xp: currentData.xp,
                achievements: currentData.achievements
            };

            saveAgentCustomizations();

            // Update 3D wizard appearance if active
            updateWizardAppearance(agent, costume, color);

            alert(`✅ ${agent.charAt(0).toUpperCase() + agent.slice(1)} appearance updated!\nCostume: ${costume}\nColor: ${color}\nLevel: ${currentData.level}\nXP: ${currentData.xp}`);
        }

        function updateWizardAppearance(agent, costume, color) {
            const agentIndex = ['austin', 'arya', 'andy', 'ryan'].indexOf(agent);
            if (agentIndex !== -1 && wizards[agentIndex]) {
                const wizard = wizards[agentIndex];
                wizard.material.color.setStyle(color);
                wizard.userData.costume = costume;
                console.log(`Updated ${agent} wizard appearance: ${costume}, ${color}`);
            }
        }

        // Grand Wizard Controls
        function activateAllEmbodiments() {
            Object.keys(activeEmbodiments).forEach(agent => {
                activeEmbodiments[agent] = true;
                activateSoraFeed(agent);
                linkWizardToEmbodiment(agent, true);
            });
            updateEmbodimentIndicators();
            alert('🎬 All Sora 2 embodiments activated!\nAll wizards are now live and interactive.');
        }

        function deactivateAllEmbodiments() {
            Object.keys(activeEmbodiments).forEach(agent => {
                activeEmbodiments[agent] = false;
                const video = document.getElementById(`${agent}-sora-video`);
                const placeholder = document.getElementById(`${agent}-video`);
                if (video) video.style.display = 'none';
                if (placeholder) placeholder.style.display = 'flex';
                linkWizardToEmbodiment(agent, false);
            });
            updateEmbodimentIndicators();
            alert('⏹️ All embodiments deactivated.\nWizards returned to ethereal realm.');
        }

        function regenerateAllSoraVideos() {
            alert('🔄 Sora 2 Video Regeneration\n\nThis would generate new custom videos for all agents based on their current customizations.\n\nFeature: Coming with Sora 2 API integration');
        }

        function syncAllWizards() {
            Object.keys(activeEmbodiments).forEach(agent => {
                linkWizardToEmbodiment(agent, activeEmbodiments[agent]);
            });
            alert('🔗 All wizards synchronized with embodiment status!\n3D wizards now reflect Sora feed activation state.');
        }

        function enterGrandWizardMode() {
            // Activate all systems as Grand Wizard
            activateAllEmbodiments();
            if (!wizardMode) activateWizardMode();
            
            // Enhanced permissions (would normally check wallet)
            alert('👑 GRAND WIZARD MODE ACTIVATED!\n\nYou are now the supreme ruler of all realms!\n\n• Control all agent embodiments\n• Command the 3D wizard council\n• Access to all realm secrets\n• Unlimited customization power\n\nWelcome, Grand Wizard! ⚡🧙‍♂️');

            // Award massive XP for Grand Wizard achievement
            ['austin', 'arya', 'andy', 'ryan'].forEach(agent => addXP(agent, 10, 'grandWizard'));
        }

        // Status Dashboard
        function refreshWizardStatus() {
            const statusDiv = document.getElementById('wizardStatusDisplay');
            let status = '🎭 WIZARD REALM STATUS\n\n';

            status += 'SORA EMBODIMENTS:\n';
            Object.keys(activeEmbodiments).forEach(agent => {
                const statusIcon = activeEmbodiments[agent] ? '🟢 ACTIVE' : '🔴 INACTIVE';
                const custom = agentCustomizations[agent];
                status += `${agent.charAt(0).toUpperCase() + agent.slice(1)}: ${statusIcon} | Lv.${custom.level} (${custom.xp} XP)\n`;
            });

            status += '\n3D WIZARDS:\n';
            status += `Wizard Mode: ${wizardMode ? '🟢 ACTIVE' : '🔴 INACTIVE'}\n`;
            status += `Active Wizards: ${wizards.filter(w => w.visible).length}/4\n`;

            status += '\nACHIEVEMENTS:\n';
            Object.keys(agentCustomizations).forEach(agent => {
                const custom = agentCustomizations[agent];
                const achievementCount = custom.achievements.length;
                status += `${agent}: ${achievementCount} unlocked\n`;
            });

            statusDiv.textContent = status;
        }

        // Sora Video Customization
        function generateCustomSoraVideo() {
            const prompt = document.getElementById('soraPromptInput').value;
            const selectedAgent = document.getElementById('agentSelector').value;
            
            if (!prompt) {
                alert('❌ Please enter a video description prompt');
                return;
            }

            alert(`🎬 Custom Sora 2 Video Generation\n\nAgent: ${selectedAgent.charAt(0).toUpperCase() + selectedAgent.slice(1)}\n\nPrompt: "${prompt}"\n\nThis would generate a custom video embodiment using Sora 2 with your specified prompt.\n\nFeature: Ready for Sora 2 API integration`);
        }

        // Load customizations on page load
        function loadAgentCustomizations() {
            const saved = localStorage.getItem('agentCustomizations');
            if (saved) {
                const loaded = JSON.parse(saved);
                // Merge with defaults to ensure all properties exist
                Object.keys(agentCustomizations).forEach(agent => {
                    if (loaded[agent]) {
                        agentCustomizations[agent] = {
                            costume: loaded[agent].costume || agentCustomizations[agent].costume,
                            color: loaded[agent].color || agentCustomizations[agent].color,
                            level: loaded[agent].level || 1,
                            xp: loaded[agent].xp || 0,
                            achievements: loaded[agent].achievements || []
                        };
                    }
                });
            }
        }

        // Save customizations
        function saveAgentCustomizations() {
            localStorage.setItem('agentCustomizations', JSON.stringify(agentCustomizations));
        }

        // Content Library Functions
        function openContentLibrary() {
            if (!window.contentSharingManager) {
                alert('❌ Content sharing system not loaded');
                return;
            }

            const content = window.contentSharingManager.getContent();
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--neon-blue); margin: 0;">📚 CONTENT LIBRARY</h2>
                        <button class="cyber-btn cyber-btn-secondary" onclick="this.closest('.modal-overlay').remove()">✕ Close</button>
                    </div>

                    <div class="content-filters" style="margin-bottom: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                        <select id="contentTypeFilter" class="cyber-input" style="padding: 8px; background: var(--panel-bg); border: 1px solid var(--neon-blue); color: var(--neon-blue); border-radius: 5px;">
                            <option value="">All Types</option>
                            <option value="images">Images</option>
                            <option value="videos">Videos</option>
                            <option value="tutorials">Tutorials</option>
                            <option value="text">Text</option>
                        </select>
                        <select id="contentCreatorFilter" class="cyber-input" style="padding: 8px; background: var(--panel-bg); border: 1px solid var(--neon-blue); color: var(--neon-blue); border-radius: 5px;">
                            <option value="">All Creators</option>
                            <option value="ai-assistant">AI Assistant</option>
                            <option value="openai-orchestrator">OpenAI</option>
                            <option value="tutorial-generator">Tutorial System</option>
                        </select>
                        <button class="cyber-btn" onclick="filterContentLibrary()">🔍 Filter</button>
                        <button class="cyber-btn cyber-btn-secondary" onclick="refreshContentLibrary()">🔄 Refresh</button>
                    </div>

                    <div id="contentLibraryItems" class="content-items" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                        ${generateContentItemsHTML(content)}
                    </div>

                    ${content.length === 0 ? '<div style="text-align: center; color: var(--neon-orange); padding: 3rem;">No content available yet. Generate some AI responses or tutorials to populate the library!</div>' : ''}
                </div>
            `;

            document.body.appendChild(modal);

            // Award XP for accessing library
            addXP('ryan', 2, 'libraryCurator');
        }

        function generateContentItemsHTML(content) {
            return content.slice(0, 20).map(item => {
                const typeIcon = {
                    images: '🖼️',
                    videos: '🎥',
                    tutorials: '📚',
                    text: '📄'
                }[item.type] || '📄';

                const previewText = item.type === 'text' && item.data.response ?
                    item.data.response.substring(0, 100) + '...' :
                    item.type === 'images' && item.data.url ?
                    `<img src="${item.data.url}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 5px;" onerror="this.style.display='none'">` :
                    'Content preview not available';

                return `
                    <div class="content-item" style="background: var(--panel-bg); border: 1px solid var(--neon-blue); border-radius: 8px; padding: 1rem; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <span style="color: var(--neon-green); font-size: 1.2rem;">${typeIcon}</span>
                            <span style="color: var(--neon-orange); font-size: 0.8rem;">${new Date(item.createdAt).toLocaleDateString()}</span>
                        </div>
                        <h4 style="color: var(--neon-blue); margin-bottom: 0.5rem; font-size: 0.9rem;">${item.data.title || item.type.toUpperCase()}</h4>
                        <div style="color: var(--neon-green); font-size: 0.8rem; margin-bottom: 1rem; min-height: 60px;">
                            ${previewText}
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            ${item.tags.slice(0, 3).map(tag => `<span style="background: rgba(0,255,255,0.1); color: var(--neon-blue); padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;">${tag}</span>`).join('')}
                        </div>
                        <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                            <button class="cyber-btn cyber-btn-secondary" style="font-size: 0.8rem; padding: 4px 8px;" onclick="viewContentItem('${item.id}')">👁️ View</button>
                            <button class="cyber-btn cyber-btn-secondary" style="font-size: 0.8rem; padding: 4px 8px;" onclick="shareContentItem('${item.id}')">📤 Share</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterContentLibrary() {
            const typeFilter = document.getElementById('contentTypeFilter').value;
            const creatorFilter = document.getElementById('contentCreatorFilter').value;

            if (!window.contentSharingManager) return;

            let content = window.contentSharingManager.getContent();

            if (typeFilter) {
                content = content.filter(item => item.type === typeFilter);
            }

            if (creatorFilter) {
                content = content.filter(item => item.creator === creatorFilter);
            }

            const itemsContainer = document.getElementById('contentLibraryItems');
            if (itemsContainer) {
                itemsContainer.innerHTML = generateContentItemsHTML(content);
            }
        }

        function refreshContentLibrary() {
            if (window.contentSharingManager) {
                const content = window.contentSharingManager.getContent();
                const itemsContainer = document.getElementById('contentLibraryItems');
                if (itemsContainer) {
                    itemsContainer.innerHTML = generateContentItemsHTML(content);
                }
            }
        }

        function viewContentItem(itemId) {
            if (!window.contentSharingManager) return;

            const item = window.contentSharingManager.getContentById(itemId);
            if (!item) {
                alert('❌ Content item not found');
                return;
            }

            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--neon-blue); margin: 0;">📖 Content Details</h2>
                        <button class="cyber-btn cyber-btn-secondary" onclick="this.closest('.modal-overlay').remove()">✕ Close</button>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: var(--neon-green); margin-bottom: 1rem;">${item.data.title || item.type.toUpperCase()}</h3>
                        <div style="color: var(--neon-orange); margin-bottom: 1rem;">
                            <strong>Type:</strong> ${item.type} |
                            <strong>Creator:</strong> ${item.creator} |
                            <strong>Created:</strong> ${new Date(item.createdAt).toLocaleString()}
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
                            ${item.tags.map(tag => `<span style="background: rgba(0,255,255,0.1); color: var(--neon-blue); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${tag}</span>`).join('')}
                        </div>
                    </div>

                    <div style="background: var(--panel-bg); border: 1px solid var(--neon-blue); border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                        ${item.type === 'text' ? `<div style="color: var(--neon-green); line-height: 1.6; white-space: pre-wrap;">${item.data.response || item.data.content || 'No content available'}</div>` :
                          item.type === 'images' ? `<img src="${item.data.url}" style="max-width: 100%; border-radius: 5px;" onerror="this.style.display='none'"><p style="color: var(--neon-blue); margin-top: 1rem;">${item.data.prompt || 'Generated image'}</p>` :
                          item.type === 'videos' ? `<p style="color: var(--neon-green);">Video: ${item.data.title || 'Generated video'}</p><p style="color: var(--neon-blue);">${item.data.prompt || 'No description available'}</p>` :
                          `<p style="color: var(--neon-green);">Tutorial: ${item.data.title || 'Generated tutorial'}</p>`}
                    </div>

                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="cyber-btn" onclick="shareContentItem('${item.id}')">📤 Share This Item</button>
                        <button class="cyber-btn cyber-btn-secondary" onclick="exportContentItem('${item.id}')">💾 Export</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function shareContentItem(itemId) {
            if (!window.contentSharingManager) return;

            const userId = prompt('Enter recipient user ID (austin, arya, andy, or ryan):');
            if (!userId || !['austin', 'arya', 'andy', 'ryan'].includes(userId.toLowerCase())) {
                alert('❌ Invalid user ID. Please enter austin, arya, andy, or ryan.');
                return;
            }

            window.contentSharingManager.shareContent(itemId, [userId.toLowerCase()]);
            alert(`✅ Content shared with ${userId.charAt(0).toUpperCase() + userId.slice(1)}!`);

            // Award XP for sharing
            addXP('ryan', 1);
        }

        function exportContentItem(itemId) {
            if (!window.contentSharingManager) return;

            const item = window.contentSharingManager.getContentById(itemId);
            if (!item) return;

            const dataStr = JSON.stringify(item, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.href = url;
            link.download = `content-${item.id}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            alert('✅ Content exported successfully!');
        }

        function refreshContentStats() {
            if (!window.contentSharingManager) {
                document.getElementById('contentStats').textContent = 'System not loaded';
                return;
            }

            const stats = window.contentSharingManager.getStats();
            const statsText = `Total: ${stats.totalItems}\nImages: ${stats.byType.images || 0}\nVideos: ${stats.byType.videos || 0}\nTutorials: ${stats.byType.tutorials || 0}\nText: ${stats.byType.text || 0}\n\nLast Updated: ${new Date(stats.lastUpdated).toLocaleString()}`;
            document.getElementById('contentStats').textContent = statsText;
        }

        function shareRecentContent() {
            if (!window.contentSharingManager) {
                alert('❌ Content sharing system not loaded');
                return;
            }

            const userId = document.getElementById('shareUserSelect').value;
            const recentContent = window.contentSharingManager.getContent().slice(0, 5); // Last 5 items

            if (recentContent.length === 0) {
                alert('No content available to share');
                return;
            }

            recentContent.forEach(item => {
                window.contentSharingManager.shareContent(item.id, [userId]);
            });

            alert(`✅ Shared ${recentContent.length} recent items with ${userId.charAt(0).toUpperCase() + userId.slice(1)}`);
        }

        function exportContentLibrary() {
            if (!window.contentSharingManager) {
                alert('❌ Content sharing system not loaded');
                return;
            }

            const libraryData = window.contentSharingManager.exportLibrary();
            const dataStr = JSON.stringify(libraryData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'gem-bot-content-library.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('✅ Content library exported successfully!');
        }

        function createTutorialPlaylist() {
            if (!window.tutorialVideoGenerator) {
                alert('❌ Tutorial generator not loaded');
                return;
            }

            const playlist = window.tutorialVideoGenerator.createTutorialPlaylist(['assembly', 'jewelry', 'sales', 'advanced']);
            alert(`✅ Tutorial Playlist Created!\n\n📋 ${playlist.title}\n\nIncludes:\n• ${playlist.tutorials.map(t => t.title).join('\n• ')}\n\nTotal Duration: ${playlist.totalDuration}\n\nPlaylist saved to content library!`);
        }

        // Initialize content stats on load
        window.addEventListener('load', function() {
            console.log('🚀 Initializing Gem Bot Universe...');

            // Maintain session state
            restoreSessionState();

            loadAgentCustomizations();
            refreshWizardStatus();
            refreshContentStats();
            checkSystemArchitectStatus(); // Check for System Architect distribution controls
            initScene();
        });

        // Session persistence across page transitions
        function restoreSessionState() {
            // Restore wallet connection
            if (window.authIntegration) {
                window.authIntegration.init({ showUI: false, requireAuth: false });
            }

            // Restore wizard mode
            const savedWizardMode = localStorage.getItem('wizardMode');
            if (savedWizardMode === 'true') {
                wizardMode = true;
                createWizards();
            }

            // Restore embodiments
            const savedEmbodiments = localStorage.getItem('activeEmbodiments');
            if (savedEmbodiments) {
                Object.assign(activeEmbodiments, JSON.parse(savedEmbodiments));
                updateEmbodimentIndicators();
            }

            // Restore mission control state
            const savedMissionControl = localStorage.getItem('missionControlVisible');
            if (savedMissionControl === 'true') {
                const panel = document.getElementById('missionControl');
                if (panel) panel.style.display = 'block';
            }
        }

        function saveSessionState() {
            localStorage.setItem('wizardMode', wizardMode);
            localStorage.setItem('activeEmbodiments', JSON.stringify(activeEmbodiments));
            localStorage.setItem('missionControlVisible', document.getElementById('missionControl').style.display === 'block');
        }

        // Auto-save session state
        setInterval(saveSessionState, 5000); // Save every 5 seconds

        // Agent Coin Functions
        function copyVaultAddress() {
            const vaultAddress = 'GJFCA8XxnGns9TqKsMLScyVSooyiNrNPpjp2CyQCz7z5';
            navigator.clipboard.writeText(vaultAddress).then(() => {
                alert('✅ Vault address copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = vaultAddress;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('✅ Vault address copied to clipboard!');
            });
        }

        function openKnowledgeBaseCoin() {
            window.open('https://pump.fun/coin/Aj7H2e1PW8N8d1eVLL5k49oE3LzKeo8HMhjS6tv3trow', '_blank');
        }

        function openVisionArchitectCoin() {
            window.open('https://pump.fun/coin/Axw9V2vXc6AH6jtqPJsWNC2o8knAtpqRJKXwJaSAcU7N', '_blank');
        }

        function distributeAgentCoins() {
            if (!window.contractorPaymentSystem) {
                alert('❌ Payment system not loaded');
                return;
            }

            const agentType = document.getElementById('distributionAgentType').value;
            const walletAddress = document.getElementById('distributionWallet').value;
            const amount = parseFloat(document.getElementById('distributionAmount').value);

            if (!walletAddress || !amount) {
                alert('❌ Please fill in all fields');
                return;
            }

            if (amount <= 0) {
                alert('❌ Amount must be greater than 0');
                return;
            }

            try {
                const result = window.contractorPaymentSystem.distributeAgentCoins(agentType, walletAddress, amount);
                alert(`✅ Agent coins distributed successfully!\n\nAgent: ${agentType}\nRecipient: ${walletAddress}\nAmount: ${amount}`);
                
                // Clear form
                document.getElementById('distributionWallet').value = '';
                document.getElementById('distributionAmount').value = '';
                
                // Refresh history
                refreshDistributionHistory();
            } catch (error) {
                alert(`❌ Distribution failed: ${error.message}`);
            }
        }

        function refreshDistributionHistory() {
            if (!window.contractorPaymentSystem) {
                return;
            }

            const history = window.contractorPaymentSystem.getAgentCoinDistributions();
            const historyDiv = document.getElementById('distributionHistory');
            
            if (history.length === 0) {
                historyDiv.textContent = 'No distributions yet';
                return;
            }

            historyDiv.innerHTML = history.map(dist => `
                <div style="border-bottom: 1px solid rgba(0,255,255,0.2); padding: 8px 0;">
                    <strong>${dist.agentType}:</strong> ${dist.amount} to ${dist.recipientWallet.substring(0, 8)}...
                    <br><small style="color: var(--neon-blue);">${new Date(dist.timestamp).toLocaleString()}</small>
                </div>
            `).join('');
        }

        // Check if user is System Architect to show distribution controls
        function checkSystemArchitectStatus() {
            if (window.contractorPaymentSystem && window.universalWalletAuth) {
                const userAddress = window.universalWalletAuth.getAddress();
                if (userAddress && window.contractorPaymentSystem.isSystemArchitect(userAddress)) {
                    document.getElementById('distributionControls').style.display = 'block';
                    refreshDistributionHistory();
                }
            }
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        // Initialize 3D scene on page load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('🌍 Initializing Gem Bot Universe...');
            initScene();
            checkSystemArchitectStatus();
        });
    </script>

    <footer>
        <p>&copy; 2025 Gem Bot Universe | AI-Driven Innovation Platform | All Rights Reserved</p>
    </footer>
</body>
</html>
