<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINAL INTEGRATION VERIFICATION - Gem Bot Universe</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .final-summary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üéØ FINAL INTEGRATION VERIFICATION - Gem Bot Universe</h1>
    <p>Comprehensive test of all functionality after Agent Hub reorganization and navigation fixes.</p>

    <div class="test-section">
        <h2>Test 1: Agent Hub File Verification</h2>
        <button onclick="testAgentHubFile()">Verify Agent Hub File</button>
        <div id="agent-hub-file-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Navigation Function Test</h2>
        <button onclick="testNavigationFunction()">Test Navigation Logic</button>
        <div id="navigation-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: URL Resolution Test</h2>
        <button onclick="testURLResolution()">Test URL Resolution</button>
        <div id="url-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Main Page Integrity</h2>
        <button onclick="testMainPageIntegrity()">Test Main Page</button>
        <div id="main-page-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: 3D Scene Functionality</h2>
        <button onclick="test3DSceneFunctionality()">Test 3D Scene</button>
        <div id="scene-result"></div>
    </div>

    <div class="final-summary">
        <h2>üöÄ COMPREHENSIVE SYSTEM VERIFICATION</h2>
        <button onclick="runCompleteSystemVerification()">üî¨ Run Complete System Verification</button>
        <div id="complete-verification-result"></div>
    </div>

    <script>
        // Test Functions
        async function testAgentHubFile() {
            const result = document.getElementById('agent-hub-file-result');

            try {
                // Test if agent-hub.html exists at the correct URL
                const response = await fetch('https://barbrickdesign.github.io/mandem.os/agent-hub.html');
                if (response.ok) {
                    const content = await response.text();
                    const hasTitle = content.includes('GRAND WIZARD REALM CONTROL');
                    const hasAuth = content.includes('Phantom Wallet');
                    const hasScripts = content.includes('universal-wallet-auth.js');

                    if (hasTitle && hasAuth && hasScripts) {
                        result.innerHTML = '<div class="test-result success">‚úÖ Agent Hub file exists and is properly configured</div>';
                        result.innerHTML += '<div class="test-result success">‚úÖ Authentication system present</div>';
                        result.innerHTML += '<div class="test-result success">‚úÖ All required scripts loaded</div>';
                        return true;
                    } else {
                        result.innerHTML = '<div class="test-result error">‚ùå Agent Hub file exists but is incomplete</div>';
                        return false;
                    }
                } else {
                    result.innerHTML = '<div class="test-result error">‚ùå Agent Hub file not accessible at correct URL</div>';
                    return false;
                }
            } catch (error) {
                result.innerHTML = '<div class="test-result error">‚ùå Error testing Agent Hub file: ' + error.message + '</div>';
                return false;
            }
        }

        function testNavigationFunction() {
            const result = document.getElementById('navigation-result');

            // Test if navigateTo function exists
            if (typeof navigateTo !== 'function') {
                result.innerHTML = '<div class="test-result error">‚ùå navigateTo function not found</div>';
                return false;
            }

            // Test the logic for agent-hub navigation
            try {
                // We can't actually test the navigation without triggering it,
                // but we can verify the function structure
                const funcString = navigateTo.toString();
                const hasAgentHubCheck = funcString.includes('agent-hub');
                const hasURLAssignment = funcString.includes('barbrickdesign.github.io');

                if (hasAgentHubCheck && hasURLAssignment) {
                    result.innerHTML = '<div class="test-result success">‚úÖ navigateTo function properly configured for Agent Hub</div>';
                    result.innerHTML += '<div class="test-result success">‚úÖ Correct GitHub Pages URL used</div>';
                    return true;
                } else {
                    result.innerHTML = '<div class="test-result error">‚ùå navigateTo function missing Agent Hub logic</div>';
                    return false;
                }
            } catch (error) {
                result.innerHTML = '<div class="test-result error">‚ùå Error testing navigation function: ' + error.message + '</div>';
                return false;
            }
        }

        function testURLResolution() {
            const result = document.getElementById('url-result');

            // Test URL construction
            const expectedURL = 'https://barbrickdesign.github.io/mandem.os/agent-hub.html';
            const currentLocation = window.location.href;
            const isOnGitHub = currentLocation.includes('barbrickdesign.github.io');

            result.innerHTML = '<div class="test-result success">Current location: ' + currentLocation + '</div>';
            result.innerHTML += '<div class="test-result success">Expected Agent Hub URL: ' + expectedURL + '</div>';

            if (isOnGitHub) {
                result.innerHTML += '<div class="test-result success">‚úÖ Running on GitHub Pages - URL resolution should work</div>';
                return true;
            } else {
                result.innerHTML += '<div class="test-result warning">‚ö†Ô∏è Not running on GitHub Pages - local testing mode</div>';
                return true;
            }
        }

        function testMainPageIntegrity() {
            const result = document.getElementById('main-page-result');

            // Test essential elements
            const checks = [
                { name: 'Globe Container', check: document.getElementById('globe-container') !== null },
                { name: 'Mission Control', check: document.getElementById('missionControl') !== null },
                { name: 'Agent Hub Navigation', check: document.querySelector('.nav-card h3') && document.querySelector('.nav-card h3').textContent.includes('AGENT HUB') },
                { name: 'Agent Coin Vault', check: document.querySelector('.agent-coin-card') !== null },
                { name: '3D Scene Functions', check: typeof initScene === 'function' && typeof animate === 'function' }
            ];

            let passed = 0;
            checks.forEach(check => {
                if (check.check) {
                    result.innerHTML += `<div class="test-result success">‚úÖ ${check.name} present and functional</div>`;
                    passed++;
                } else {
                    result.innerHTML += `<div class="test-result error">‚ùå ${check.name} missing or broken</div>`;
                }
            });

            result.innerHTML += `<div class="test-result ${passed === checks.length ? 'success' : 'error'}">üìä Main Page Integrity: ${passed}/${checks.length} components working</div>`;

            return passed === checks.length;
        }

        function test3DSceneFunctionality() {
            const result = document.getElementById('scene-result');

            // Test 3D scene components
            const sceneChecks = [
                { name: 'WebGL Support', check: window.WebGLRenderingContext !== undefined },
                { name: 'THREE.js Library', check: typeof THREE !== 'undefined' },
                { name: 'Scene Initialization', check: typeof initScene === 'function' },
                { name: 'Animation Loop', check: typeof animate === 'function' },
                { name: 'Fallback Function', check: typeof showGlobeFallback === 'function' }
            ];

            let passed = 0;
            sceneChecks.forEach(check => {
                if (check.check) {
                    result.innerHTML += `<div class="test-result success">‚úÖ ${check.name} available</div>`;
                    passed++;
                } else {
                    result.innerHTML += `<div class="test-result error">‚ùå ${check.name} missing</div>`;
                }
            });

            // Test WebGL capability
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    result.innerHTML += '<div class="test-result success">‚úÖ WebGL context creation successful</div>';
                    passed++;
                } else {
                    result.innerHTML += '<div class="test-result warning">‚ö†Ô∏è WebGL context creation failed - fallback will be used</div>';
                }
            } catch (error) {
                result.innerHTML += '<div class="test-result warning">‚ö†Ô∏è WebGL test failed - fallback system in place</div>';
            }

            result.innerHTML += `<div class="test-result success">üìä 3D Scene System: ${passed}/${sceneChecks.length + 1} components functional</div>`;

            return passed >= sceneChecks.length; // Allow for WebGL test to be optional
        }

        async function runCompleteSystemVerification() {
            const result = document.getElementById('complete-verification-result');

            result.innerHTML = '<div class="test-result warning">üîÑ Running comprehensive system verification...</div>';

            // Run all tests
            const testResults = await Promise.all([
                testAgentHubFile(),
                testNavigationFunction(),
                testURLResolution(),
                testMainPageIntegrity(),
                test3DSceneFunctionality()
            ]);

            const passedTests = testResults.filter(test => test === true).length;
            const totalTests = testResults.length;

            // Additional verification
            const navigationCardExists = document.querySelector('.nav-card h3') && document.querySelector('.nav-card h3').textContent.includes('AGENT HUB');
            const noWizardContent = document.querySelectorAll('.wizard-section, .wizard-control-card').length === 0;

            setTimeout(() => {
                result.innerHTML = `
                    <div class="test-result success">üéØ SYSTEM VERIFICATION COMPLETE</div>
                    <div class="test-result success">‚úÖ Core Tests Passed: ${passedTests}/${totalTests}</div>
                    <div class="test-result success">‚úÖ Agent Hub Navigation: ${navigationCardExists ? 'Present' : 'Missing'}</div>
                    <div class="test-result success">‚úÖ Wizard Content Removed: ${noWizardContent ? 'Clean' : 'Still Present'}</div>
                `;

                if (passedTests === totalTests && navigationCardExists && noWizardContent) {
                    result.innerHTML += '<div class="test-result success">üéâ ALL SYSTEMS VERIFIED AND FUNCTIONAL!</div>';
                    result.innerHTML += '<div class="test-result success">‚úÖ Agent Hub properly separated</div>';
                    result.innerHTML += '<div class="test-result success">‚úÖ Navigation working correctly</div>';
                    result.innerHTML += '<div class="test-result success">‚úÖ Main page clean and functional</div>';
                    result.innerHTML += '<div class="test-result success">‚úÖ 3D scene with proper fallback</div>';
                    result.innerHTML += '<div class="test-result success">‚úÖ All integration points verified</div>';
                } else {
                    result.innerHTML += '<div class="test-result error">‚ùå Some verification checks failed</div>';
                    if (!navigationCardExists) result.innerHTML += '<div class="test-result error">- Agent Hub navigation card missing</div>';
                    if (!noWizardContent) result.innerHTML += '<div class="test-result error">- Wizard content still present in main page</div>';
                }
            }, 2000);
        }

        // Auto-run basic checks on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testURLResolution();
                testMainPageIntegrity();
            }, 500);
        });
    </script>
</body>
</html>
